<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Aviator Analyzer Pro</title>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<style>
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#2d185f;color:#fff;min-height:100vh;padding:8px;margin:0;}
.container{max-width:900px;margin:0 auto;}
.header{text-align:center;padding:15px;background:rgba(255,255,255,0.07);border-radius:12px 12px 18px 18px;margin-bottom:12px;}
.sync-badge{display:inline-block; background:rgba(20,255,20,0.10); padding:6px 15px; border-radius:9px;}
.crashes-section{background:rgba(255,255,255,0.07);border-radius:10px;padding:10px 12px 7px 12px;margin-bottom:9px;}
.crashes-row{display:flex;gap:5px;flex-wrap:wrap;}
.crash-item{padding:6px 8px;border-radius:6px;font-size:1em;font-weight:bold;border:1.5px solid rgba(255,255,255,0.13);min-width:38px;text-align:center;flex:1 0 37px;}
.azul{background:rgba(0,212,255,0.18);color:#00d4ff;}
.verde{background:rgba(3,218,198,0.14);color:#03dac6;}
.morado{background:rgba(187,134,252,0.16);color:#bb86fc;}
.fucsia{background:rgba(255,20,147,0.18);color:#ff1493;}
.main-section{display:grid;grid-template-columns:2fr 1fr;gap:13px;margin-bottom:10px;}
.signal-panel{background:linear-gradient(135deg,#0f2027 0%,#2c5364 100%);border-radius:11px;padding:18px 0;text-align:center;min-height:100px;}
.signal-panel.blocked{background:#792929;}
.signal-panel.hot{background:linear-gradient(135deg,#2af598 0%,#009efd 100%);}
.stats-section{background:rgba(255,255,255,0.07);border-radius:8px;padding:10px;}
.stats-grid{display:grid;grid-template-columns:1fr;gap:4px;}
.stat-item .value{font-size:1.19em;font-weight:bold;}
.stat-item .label{font-size:0.87em;opacity:0.62;}
button{padding:6px 12px;border:none;border-radius:7px;font-size:1em;cursor:pointer;}
button.primary{background:linear-gradient(135deg,#2690ff 0%,#9e52dc 100%);color:white;}
.history-section{background:rgba(255,255,255,0.06);border-radius:8px;padding:10px;}
.history-list{max-height:270px;overflow-y:auto;}
.signal-item{padding:11px;margin:5px 0;background:#14062f;border-radius:6px;border-left:4px solid #4172c2;}
.signal-item.ganada{border-left-color:#00fd84;background:rgba(0,253,132,0.09);}
.signal-item.perdida{border-left-color:#fd175c;background:rgba(253,23,92,0.08);}
.sig-header{font-weight:bold;margin-bottom:3px;}
.sig-result{padding:3px 8px;border-radius:4px;font-weight:bold;}
@media (max-width:900px){.main-section{grid-template-columns:1fr;}.signal-panel{min-height:50px;}}
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Aviator Analyzer Pro</h1>
        <div class="sync-badge"><span id="syncStatus">üîÑ Cargando...</span></div>
    </div>
    <div class="crashes-section">
        <div id="crashesDisplay"></div>
    </div>
    <div class="main-section">
        <div class="signal-panel waiting" id="signalPanel">
            <div style="font-size: 1.1em;">‚è≥</div>
            <p style="font-size: 1em;">Cargando...</p>
        </div>
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-item"><div class="label">Rondas Totales</div><div class="value" id="statRounds">0</div></div>
                <div class="stat-item"><div class="label">Se√±ales Generadas</div><div class="value" id="statSignals">0</div></div>
                <div class="stat-item"><div class="label">Ganadas</div><div class="value" id="statWon">0</div></div>
                <div class="stat-item"><div class="label">% de Aciertos</div><div class="value" id="statWinRate">--%</div></div>
            </div>
            <button class="primary" onclick="window.location.reload()">Reiniciar</button>
        </div>
    </div>
    <div class="history-section">
        <div id="signalList" class="history-list"><p style="opacity:.5;text-align:center;">Sin se√±ales a√∫n...</p></div>
    </div>
    <footer style="text-align:center;padding:7px 0;opacity:.42;">Aviator Analyzer Pro - solo se√±ales de esta sesi√≥n</footer>
</div>
<audio id="beep" preload="auto"><source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAIA+AAACABAAZGF0YYQAAACAgICA" type="audio/wav"></audio>
<script>
const firebaseConfig = {
    apiKey: "AlzaSyDuEnNg5XutDF3Ka90o6GFKTazBLR9NnSs",
    authDomain: "aviator-analyzer-b29a7.firebaseapp.com",
    projectId: "aviator-analyzer-b29a7",
    storageBucket: "aviator-analyzer-b29a7.appspot.com",
    messagingSenderId: "575063626276",
    appId: "1:575063626276:web:dc0f8c2b1cf8e2f9bb4f91",
    databaseURL: "https://aviator-analyzer-b29a7-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

class AviatorSystem {
    constructor() {
        this.historico = [];
        this.senales = [];
        this.rondasDesdeSenal = 0;
        this.senalesEnRacha = 0;
        this.listo = false;
        this.rondasTotales = 0;
        this.lastKey = null;
        this.bloqueado = true;
        this.iniciar();
    }

    iniciar() {
        db.ref('feeds/gocho/crashes').orderByKey().limitToLast(1).once('value', snap => {
            snap.forEach(child => { this.lastKey = child.key; });
            this.senales = [];
            this.historico = [];
            this.rondasDesdeSenal = 0; this.rondasTotales = 0;
            this.senalesEnRacha = 0;
            this.listo = true;
            document.getElementById('syncStatus').innerHTML = '‚úÖ Sistema listo - Analizando';
            db.ref('feeds/gocho/crashes').on('child_added', s => this.crashNuevoUltralimpio(s));
            this.actualizarInterfaz();
        });
    }

    crashNuevoUltralimpio(snap) {
        if (!this.listo || !snap || !snap.key) return;
        if (this.bloqueado) {
            if (snap.key === this.lastKey) return;
            this.bloqueado = false;
        }
        let data = snap.val();
        if (!data || !data.v || !data.ts) return;
        let valor = parseFloat(data.v);
        this.historico.push({
            valor,
            tiempo: data.ts,
            categoria: this.categorizar(valor),
            key: snap.key
        });
        if (this.historico.length > 1000) this.historico.shift();
        this.rondasTotales++;
        this.rondasDesdeSenal++;
        this.verificarResultados();
        let senal = this.generarSenal();
        if (senal.tipo === 'ACTIVA') this.emitirBeep();
        this.actualizarInterfaz();
    }

    categorizar(mult) {
        if (mult < 1.5) return 'azul';
        if (mult >= 1.5 && mult < 2.0) return 'verde';
        if (mult >= 2.0 && mult < 10.0) return 'morado';
        return 'fucsia';
    }
    detectarRachaCaliente() {
        if (this.historico.length < 8) return false;
        const ult8 = this.historico.slice(-8);
        const altos = ult8.filter(c => c.categoria === 'morado' || c.categoria === 'fucsia').length;
        const azules = ult8.filter(c => c.categoria === 'azul').length;
        return altos >= 6 && azules === 0;
    }
    detectarZonaPeligrosa() {
        if (this.historico.length < 8) return false;
        const ult8 = this.historico.slice(-8);
        return ult8.filter(c => c.categoria === 'azul').length >= 4;
    }
    verificarResultados() {
        if (!this.senales.length) return;
        let idx = this.senales.findIndex(s => s.resultado === 'PENDIENTE' && !s.verificada && s.idxHistorico !== undefined);
        if (idx === -1) return;
        let s = this.senales[idx];
        let idxRonda = s.idxHistorico + 1;
        if (this.historico.length > idxRonda) {
            let ronda = this.historico[idxRonda];
            if (!ronda) return;
            let mult = ronda.valor;
            if (mult >= parseFloat(s.rango.min) && mult <= parseFloat(s.rango.max)) {
                s.resultado = 'GANADA';
            } else {
                s.resultado = 'PERDIDA';
            }
            s.resultadoReal = Number(mult).toFixed(2);
            s.verificada = true;
        }
    }
    generarSenal() {
        if (this.senales.length && this.senales[this.senales.length-1].resultado === 'PENDIENTE')
            return { tipo: 'ESPERANDO', msg: '‚è≥ Esperando resultado de la se√±al anterior', emoji: '‚è≥' };
        if (!this.listo || this.bloqueado) return { tipo: 'ESPERANDO', msg:`‚è≥ Esperando ronda nueva`, emoji:'‚è≥'};
        if (this.historico.length < 15) return { tipo:'ESPERANDO', msg:`‚è≥ Datos (${this.historico.length}/15)`, emoji:'‚è≥'};
        if (this.detectarZonaPeligrosa()) return { tipo:'BLOQUEADO', msg:'üö´ BLOQUEADO', emoji:'‚ö†Ô∏è'};
        if (this.detectarRachaCaliente()) {
            if (this.rondasDesdeSenal >= 2 && this.senalesEnRacha < 5) {
                const ult = this.historico.slice(-20);
                const media = ult.reduce((a,c)=>a+c.valor,0)/20;
                const min = (media*0.85).toFixed(2), max = (media*1.3).toFixed(2);
                this.senales.push({ rango:{min,max}, resultado:'PENDIENTE', verificada:false, rondaEntrada:this.rondasTotales, idxHistorico:this.historico.length-1 });
                this.rondasDesdeSenal=0; this.senalesEnRacha++;
                return { tipo:'ACTIVA', msg:`${min}x - ${max}x`, emoji:'üî•', confidence:'85%', modo:'üî• RACHA CALIENTE' };
            }
            return { tipo:'ESPERANDO', msg:`‚è≥ ${this.rondasDesdeSenal}/2`, emoji:'üî•'};
        }
        if (this.rondasDesdeSenal >= 5) {
            const ult = this.historico.slice(-15);
            const altos = ult.filter(c=>c.categoria==='morado'||c.categoria==='fucsia').length;
            let min,max,confidence;
            if (altos>=8) {
                const media = ult.reduce((a,c)=>a+c.valor,0)/15;
                min=(media*0.8).toFixed(2); max=(media*1.2).toFixed(2); confidence='75%';
            } else {
                min='1.7';max='2.6';confidence='65%';
            }
            this.senales.push({ rango:{min,max}, resultado:'PENDIENTE', verificada:false, rondaEntrada:this.rondasTotales, idxHistorico:this.historico.length-1 });
            this.rondasDesdeSenal=0; this.senalesEnRacha=0;
            return { tipo:'ACTIVA', msg:`${min}x - ${max}x`, emoji:'üü°', confidence, modo:'‚ö™ NORMAL' };
        }
        return { tipo:'ESPERANDO', msg:`‚è≥ ${this.rondasDesdeSenal}/5`, emoji:'‚ö™'};
    }
    emitirBeep() {
        const beep=document.getElementById('beep');try{beep.currentTime=0;beep.play();}catch(e){}
    }
    actualizarInterfaz() {
        this.actualizarPanel();
        this.actualizarCrashes();
        this.actualizarStats();
        this.actualizarHistorial();
    }
    actualizarPanel() {
        let senal = {tipo:'ESPERANDO',msg:'‚è≥ Esperando ronda nueva',emoji:'‚è≥'};
        if (this.senales.length) {
            const ult=this.senales[this.senales.length-1];
            if (ult.resultado==='PENDIENTE') senal={tipo:'PENDIENTE',msg:'‚è≥ Se√±al pendiente',emoji:'‚è≥'};
            if (ult.resultado==='GANADA'||ult.resultado==='PERDIDA') {
                senal={tipo:ult.resultado,msg:`${ult.rango.min}x - ${ult.rango.max}x`,emoji:ult.resultado==='GANADA'?'‚úÖ':'‚ùå'};
            }
        }
        const panel=document.getElementById('signalPanel');
        if (senal.tipo==='ACTIVA') {
            panel.className='signal-panel hot';
            panel.innerHTML=`<div class="signal-value">${senal.emoji} ${senal.msg}</div>`;
        } else if (senal.tipo==='BLOQUEADO') {
            panel.className='signal-panel blocked';
            panel.innerHTML=`<div class="signal-value">${senal.emoji} ${senal.msg}</div>`;
        } else {
            panel.className='signal-panel waiting';
            panel.innerHTML=`<div class="signal-value">${senal.emoji} ${senal.msg}</div>`;
        }
    }
    actualizarCrashes() {
        const c=document.getElementById('crashesDisplay');
        const ultimos=this.historico.slice(-15);
        if (ultimos.length===0){c.innerHTML='<p style="opacity:0.47;text-align:center;">Esperando...</p>';return;}
        let html='',fila=[];
        [...ultimos].reverse().forEach((crash,idx)=>{
            fila.push(`<div class="crash-item ${crash.categoria}">${crash.valor.toFixed(2)}</div>`);
            if(fila.length===5||idx===ultimos.length-1){html+=`<div class="crashes-row">${fila.join('')}</div>`;fila=[];}
        });c.innerHTML=html;
    }
    actualizarStats() {
        document.getElementById('statRounds').textContent=this.rondasTotales;
        document.getElementById('statSignals').textContent=this.senales.length;
        const ganadas=this.senales.filter(s=>s.resultado==='GANADA').length;
        document.getElementById('statWon').textContent=ganadas;
        const wr=this.senales.length>0?Math.round((ganadas/this.senales.length)*100):0;
        document.getElementById('statWinRate').textContent=`${wr}%`;
    }
    actualizarHistorial() {
        const c=document.getElementById('signalList');
        if(this.senales.length===0){c.innerHTML='<p style="opacity:.5;text-align:center;">Sin se√±ales a√∫n...</p>';return;}
        c.innerHTML=[...this.senales].slice(-15).reverse().map((senal,idx)=>{
            const r=senal.resultado||'PENDIENTE';
            const clase=r==='GANADA'?'ganada':r==='PERDIDA'?'perdida':'pendiente';
            const t=r==='GANADA'?'‚úÖ GANADA':r==='PERDIDA'?'‚ùå PERDIDA':'‚è≥ PENDIENTE';
            return `<div class="signal-item ${clase}">
                <div class="sig-header">Se√±al #${this.senales.length-idx}</div>
                <div>Entrada en Ronda: #${senal.rondaEntrada}</div>
                <div>Rango: ${senal.rango.min}x - ${senal.rango.max}x</div>
                ${senal.resultadoReal?`<div>Resultado Real: <b>${senal.resultadoReal}x</b></div>`:''}
                <div class="sig-result ${clase}">${t}</div>
            </div>`;
        }).join('');
    }
}
const sistema = new AviatorSystem();
</script>
</body>
</html>
