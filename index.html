<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aviator Analyzer (sin predicci√≥n)</title>
  <style>
    :root { --bg:#0b1220; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#60a5fa; --ok:#22c55e; --bad:#ef4444; }
    *{box-sizing:border-box} body{margin:0;background:#0f172a;color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial}
    .wrap{max-width:1150px;margin:0 auto;padding:24px}
    h1{font-size:24px;margin:0 0 12px} h2{font-size:18px;margin:0 0 8px}
    .row{display:grid;grid-template-columns:1fr;gap:16px}
    @media (min-width:980px){ .row-2{grid-template-columns:2fr 1fr} .row-3{grid-template-columns:2fr 1fr} }
    .card{background:#0b1220;border:1px solid #1f2937;border-radius:14px;padding:16px}
    .muted{color:var(--muted);font-size:13px}
    textarea,input,select,button{border-radius:10px;border:1px solid #374151;background:#0b1220;color:var(--text)}
    textarea{width:100%;min-height:120px;padding:10px}
    input,select{padding:10px;width:100%}
    .btn{padding:10px 14px;cursor:pointer;background:#111827;border:1px solid #334155}
    .btn:hover{border-color:#475569}
    .btn-accent{background:#1e293b;border-color:#3b82f6}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    .grid3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
    .stat{border:1px solid #1f2937;border-radius:12px;padding:10px}
    .stat .k{font-size:11px;color:var(--muted)} .stat .v{font-size:16px;font-weight:600}
    .list{margin:0;padding-left:18px;font-size:14px} .list li{margin:4px 0}
    .pill{font-size:12px;color:var(--muted)}
    .footer{font-size:12px;color:#9ca3af;margin-top:10px}
    .row-flex{display:flex;gap:8px;flex-wrap:wrap;align-items: center}
    canvas{width:100%;height:280px;background:#0a0f1f;border:1px solid #1f2937;border-radius:12px}
    .kbd{border:1px solid #334155;border-radius:6px;padding:0 6px;font-size:12px;color:#cbd5e1}
  </style>
</head>
<body>
<div class="wrap">
  <h1>üß† Aviator Analyzer <span class="pill">(sin predicci√≥n, sin autobet)</span></h1>

  <div class="card">
    <h2>Nota importante</h2>
    <p class="muted">
      Esta herramienta <b>no</b> predice resultados, no da ‚Äúse√±ales‚Äù ni automatiza apuestas en 1Win u otros sitios.
      Sirve para <b>analizar datos hist√≥ricos</b> y <b>simular gesti√≥n de banca</b>. Los juegos tipo crash son aleatorios.
    </p>
  </div>

  <!-- Sesi√≥n -->
  <div class="card">
    <h2>Sesi√≥n</h2>
    <div class="row-flex">
      <input id="sess_name" placeholder="Nombre de sesi√≥n">
      <button class="btn" id="btnNewSess">Nueva sesi√≥n</button>
    </div>
    <textarea id="sess_notes" placeholder="Notas de la sesi√≥n (opcional)"></textarea>
    <div class="footer muted">Al guardar en Firebase se incluir√°n nombre y notas.</div>
  </div>

  <div class="row row-2" style="margin-top:16px">
    <!-- Izquierda: carga, clip y opciones -->
    <div class="card">
      <h2>1) Carga de datos</h2>
      <textarea id="ta" placeholder="Pega multiplicadores separados por espacios/comas/saltos de l√≠nea (ej: 1.2 2.1 8.4 120 3.3)"></textarea>
      <div class="row-flex">
        <button class="btn btn-accent" id="btnAdd">A√±adir</button>
        <button class="btn" id="btnClear">Limpiar</button>
        <label class="btn"><input type="file" id="file" accept=".csv,.txt" hidden>Importar CSV/TXT</label>
        <button class="btn" id="btnExport">Exportar JSON</button>
      </div>

      <div class="row-flex" style="margin-top:10px">
        <input id="quick_inp" placeholder="Ingreso r√°pido (ej: 123 = 1.23)" style="width:200px">
        <button class="btn" id="quick_add">A√±adir r√°pido</button>
        <span class="muted">Pulsa <span class="kbd">Enter</span> para a√±adir.</span>
      </div>

      <div class="card" style="margin-top:16px">
        <h2>üìã Captura r√°pida (portapapeles)</h2>
        <div class="row-flex">
          <label><input type="checkbox" id="cb_autoClip"> Activar lectura autom√°tica</label>
          <label>Intervalo (ms): <input id="clip_ms" type="number" value="800" style="width:120px"></label>
          <button class="btn" id="btnClipOnce">Leer una vez (<span class="kbd">V</span>)</button>
        </div>
        <p class="muted">Uso: en la otra pesta√±a selecciona el multiplicador final y presiona <b>Ctrl+C</b>.
          Aqu√≠ se a√±adir√° autom√°ticamente si el formato es v√°lido (ej. <code>1.23x</code> o <code>1.23</code>).</p>
        <div class="muted" id="clip_status"></div>
      </div>

      <h2 style="margin-top:16px">2) Par√°metros de simulaci√≥n</h2>
      <div class="grid3">
        <div><div class="muted">Objetivo (cashout)</div><input id="inpTarget" type="number" step="0.1" value="1.5"></div>
        <div><div class="muted">Estrategia</div>
          <select id="selStrat">
            <option value="flat">Flat (fija)</option>
            <option value="martingale">Martingala</option>
            <option value="fibonacci">Fibonacci</option>
            <option value="kelly">Kelly (emp√≠rico)</option>
          </select>
        </div>
        <div><div class="muted">Rondas a simular (0=todo)</div><input id="inpRounds" type="number" value="0"></div>
        <div><div class="muted">Bankroll inicial</div><input id="inpBank" type="number" value="1000"></div>
        <div><div class="muted">Apuesta base</div><input id="inpBase" type="number" value="10"></div>
      </div>
    </div>

    <!-- Derecha: stats -->
    <div class="card">
      <h2>Estad√≠sticas</h2>
      <div class="grid">
        <div class="stat"><div class="k">Muestras</div><div class="v" id="stCount">0</div></div>
        <div class="stat"><div class="k">Media</div><div class="v" id="stMean">0.00√ó</div></div>
        <div class="stat"><div class="k">Mediana</div><div class="v" id="stMed">0.00√ó</div></div>
        <div class="stat"><div class="k">M√°ximo</div><div class="v" id="stMax">0.00√ó</div></div>
        <div class="stat"><div class="k">P(‚â•5√ó)</div><div class="v" id="stP5">0.0%</div></div>
        <div class="stat"><div class="k">P(‚â•10√ó)</div><div class="v" id="stP10">0.0%</div></div>
        <div class="stat"><div class="k">P(‚â•100√ó)</div><div class="v" id="stP100">0.0%</div></div>
        <div class="stat"><div class="k">P(‚â•1000√ó)</div><div class="v" id="stP1000">0.0%</div></div>
      </div>
      <button class="btn" id="btnSave" style="margin-top:10px">Guardar dataset en Firebase</button>
      <div class="muted" id="authInfo" style="margin-top:6px"></div>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <div class="row-flex" style="justify-content:space-between;gap:12px">
      <h2>Serie temporal (cap a 200√ó)</h2>
      <div class="row-flex">
        <label>Ventana baja (N): <input id="mw_win" type="number" value="20" style="width:90px"></label>
        <label>Umbral media: <input id="mw_thr" type="number" step="0.01" value="1.30" style="width:90px"></label>
        <button class="btn" id="mw_apply">Aplicar</button>
      </div>
    </div>
    <canvas id="chart" width="1100" height="280"></canvas>
    <div class="muted" id="mw_list" style="margin-top:6px"></div>
  </div>

  <div class="row row-2" style="margin-top:16px">
    <div class="card">
      <h2>Rachas hist√≥ricas detectadas</h2>
      <ul class="list" id="seq5"></ul>
      <ul class="list" id="seq10"></ul>
      <ul class="list" id="seq100"></ul>
      <ul class="list" id="seq1000"></ul>
    </div>

    <div class="card">
      <h2>Resultado simulaci√≥n</h2>
      <div class="grid">
        <div class="stat"><div class="k">Rounds</div><div class="v" id="smRounds">0</div></div>
        <div class="stat"><div class="k">Win rate</div><div class="v" id="smWinr">0.0%</div></div>
        <div class="stat"><div class="k">Profit</div><div class="v" id="smProfit">0.00</div></div>
        <div class="stat"><div class="k">Final bankroll</div><div class="v" id="smFinal">0.00</div></div>
        <div class="stat"><div class="k">Max drawdown</div><div class="v" id="smDD">0.00</div></div>
        <div class="stat"><div class="k">Ruin</div><div class="v" id="smRuin">No</div></div>
        <div class="stat"><div class="k">pÃÇ(hit ‚â• target)</div><div class="v" id="smPHat">0.00%</div></div>
      </div>
      <button class="btn" id="btnCSV" style="margin-top:10px">Exportar CSV (simulaci√≥n)</button>
    </div>
  </div>

  <div class="card" style="margin-top:16px">
    <h2>Firebase (opcional)</h2>
    <div class="grid3">
      <div><div class="muted">apiKey</div><input id="fb_apiKey"></div>
      <div><div class="muted">authDomain</div><input id="fb_authDomain"></div>
      <div><div class="muted">databaseURL</div><input id="fb_databaseURL"></div>
      <div><div class="muted">projectId</div><input id="fb_projectId"></div>
      <div><div class="muted">storageBucket</div><input id="fb_storageBucket"></div>
      <div><div class="muted">messagingSenderId</div><input id="fb_messagingSenderId"></div>
      <div><div class="muted">appId</div><input id="fb_appId"></div>
      <div><div class="muted">measurementId</div><input id="fb_measurementId"></div>
    </div>
    <div class="row-flex" style="margin-top:8px">
      <label><input type="checkbox" id="fb_enable"> Activar SYNC</label>
      <button class="btn" id="fb_login">Iniciar sesi√≥n Google</button>
      <button class="btn" id="fb_logout">Salir</button>
    </div>
    <div class="footer">Usa tus propias claves y rota si alguna qued√≥ p√∫blica.</div>
  </div>

  <div class="footer">Hecho con fines educativos. No es asesor√≠a financiera ni de apuestas.</div>
</div>

<script>
/* ======= Utilidades ======= */
const $ = (id)=>document.getElementById(id);
function nowStamp(){ const d=new Date(); const p=(n)=>String(n).padStart(2,'0'); return d.getFullYear()+"-"+p(d.getMonth()+1)+"-"+p(d.getDate())+" "+p(d.getHours())+":"+p(d.getMinutes()); }
function parseMultipliers(txt){
  if(!txt) return [];
  return txt.split(/[\s,;]+/).map(s=>s.trim()).filter(Boolean)
    .map(Number).filter(n=>Number.isFinite(n)&&n>0);
}
function median(a){ if(!a.length) return 0; const s=[...a].sort((x,y)=>x-y); const m=Math.floor(s.length/2); return s.length%2?s[m]:(s[m-1]+s[m])/2; }
function stats(data){
  const n=data.length; if(!n) return {count:0,mean:0,median:0,max:0,p5:0,p10:0,p100:0,p1000:0};
  const sum=data.reduce((a,b)=>a+b,0), mean=sum/n, med=median(data);
  const p=(t)=>data.filter(x=>x>=t).length/n;
  return {count:n,mean,median:med,max:Math.max(...data),p5:p(5),p10:p(10),p100:p(100),p1000:p(1000)};
}
function sequences(data,thr){
  const out=[]; let i=0; while(i<data.length){ if(data[i]>=thr){ let j=i; while(j<data.length&&data[j]>=thr) j++; out.push({start:i,end:j-1,length:j-i,peak:Math.max(...data.slice(i,j))}); i=j; } else i++; }
  return out;
}
function clampSeries(data,cap=200){ return data.map((v,i)=>({i:i+1,m:Math.min(v,cap),real:v})); }
function movingMean(data,win){ const out=[]; if(win<=0) return out; for(let i=win-1;i<data.length;i++){ let s=0; for(let k=i-win+1;k<=i;k++) s+=data[k]; out.push({end:i,mean:s/win}); } return out; }
function segmentsBelowMM(data, win, thr){
  const mm = movingMean(data, win);
  const segs=[]; let i=0;
  while(i<mm.length){
    if(mm[i].mean < thr){
      let j=i; let low=mm[i].mean; let maxLow=low;
      while(j<mm.length && mm[j].mean < thr){ maxLow=Math.min(maxLow, mm[j].mean); j++; }
      // en indices originales: start = (i_end - win + 1)
      const start = (i + win - 1) - (win-1);  // simplifica a i
      const end = (j-1) + (win - 1);          // √∫ltimo √≠ndice cubierto
      segs.push({start: start, end: end, win, thr, minMean: maxLow});
      i=j;
    } else i++;
  }
  return segs;
}

/* ======= Simulaci√≥n ======= */
function nextBetMartingale(prev, lastWin){ if(lastWin===null) return prev; return lastWin?prev:prev*2; }
function nextBetFib(idx,lastWin,base){ const seq=[1,1,2,3,5,8,13,21,34,55]; if(lastWin===null) return {bet:base*seq[idx],idx}; if(lastWin){const ni=Math.max(0,idx-2);return {bet:base*seq[ni],idx:ni};} const ni=Math.min(seq.length-1,idx+1); return {bet:base*seq[ni],idx:ni}; }
function kellyFraction(p,b){ const q=1-p; co
