<!doctype html>
<html lang="es">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RTDB Live</title>
<style>
  body{margin:0;background:#0f1225;color:#e8e9ff;font:16px/1.5 system-ui}
  .wrap{max-width:680px;margin:auto;padding:18px}
  .card{background:#171a34;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px}
  .muted{color:#9aa1d8} .ok{color:#10b981} pre{background:#0f132e;border-radius:10px;padding:10px}
</style>
<div class="wrap">
  <div class="card">
    <h2 style="margin:0 0 6px">RTDB en vivo</h2>
    <div class="muted">Estado: <span id="st">Conectando…</span></div>
    <div class="muted" style="margin-top:10px">Últimos 5:</div>
    <pre id="out"></pre>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-database-compat.js"></script>
<script>
const cfg = {
  apiKey:"AIzaSyDuEnNg5XutDF3Ka90o6GFKTazBLR9NnSs",
  authDomain:"aviator-analyzer-b29a7.firebaseapp.com",
  databaseURL:"https://aviator-analyzer-b29a7-default-rtdb.firebaseio.com",
  projectId:"aviator-analyzer-b29a7",
  storageBucket:"aviator-analyzer-b29a7.firebasestorage.app",
  messagingSenderId:"575063626276",
  appId:"1:575063626276:web:5f640e41f0ad791d6a3eb1",
  measurementId:"G-325QCBSQMH"
};
firebase.initializeApp(cfg);
const db = firebase.database();
const ref = db.ref('crashes'); // cambia aquí si usas otro path
const $st = document.getElementById('st');
const $out = document.getElementById('out');

let last = [];
function norm(k,o){ return {k, ts:(o.ts??o.t??Date.now())*1, v:(o.v??o.value??o)*1}; }
function render(){ $out.textContent = JSON.stringify(last.slice(-5), null, 2); }

ref.limitToLast(5).once('value', snap=>{
  const v = snap.val(); if(!v){ $st.textContent = 'Sin datos'; return; }
  last = Object.entries(v).map(([k,o])=>norm(k,o)).sort((a,b)=>a.ts-b.ts);
  $st.innerHTML = '<span class="ok">Conectado ✔</span>';
  render();
  // stream en vivo
  ref.limitToLast(1).on('child_added', s=>{
    const it = norm(s.key, s.val());
    if(last.length && it.ts <= last.at(-1).ts) return; // evita duplicados
    last.push(it);
    render();
  });
});
</script>
</html>
