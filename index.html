<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Gocho Analyzer v27.0 PRO - 1Win Edition</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

:root{
  --bg-primary:#0a0e1a;
  --bg-secondary:#0f131f;
  --surface:#1a1f2e;
  --border:rgba(255,255,255,0.08);
  --text-primary:#e8edf7;
  --text-secondary:#8b92a8;
  --text-muted:#5a5f6e;
  --accent-cyan:#00d4ff;
  --accent-green:#00ff88;
  --accent-pink:#ff0080;
  --accent-purple:#a855f7;
  --success:#10b981;
  --error:#ef4444;
  --warning:#f59e0b;
  --chip-low:rgba(0,212,255,0.15);
  --chip-med:rgba(168,85,247,0.15);
  --chip-high:rgba(255,0,128,0.15);
  --shadow:0 20px 60px rgba(0,0,0,0.4);
  --shadow-sm:0 4px 20px rgba(0,0,0,0.3);
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:'Inter',system-ui,-apple-system,sans-serif;
  background:var(--bg-primary);
  background-image:
    radial-gradient(at 0% 0%, rgba(0,212,255,0.12) 0px, transparent 50%),
    radial-gradient(at 100% 100%, rgba(168,85,247,0.1) 0px, transparent 50%);
  color:var(--text-primary);
  line-height:1.6;
  overflow-x:hidden;
}

.container{
  max-width:1400px;
  margin:0 auto;
  padding:24px;
}

.card{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:16px;
  padding:24px;
  margin-bottom:24px;
  transition:transform 0.2s ease;
}

.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:32px;
  flex-wrap:wrap;
  gap:16px;
}

.brand{
  display:flex;
  align-items:center;
  gap:12px;
}

.logo{
  width:48px;
  height:48px;
  background:linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:800;
  font-size:24px;
  box-shadow:0 4px 16px rgba(0,212,255,0.3);
}

.brand-info h1{
  font-size:24px;
  font-weight:800;
  background:linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  margin-bottom:4px;
}

.brand-info p{
  font-size:13px;
  color:var(--text-muted);
}

.status-badge{
  padding:8px 16px;
  border-radius:100px;
  font-weight:600;
  font-size:13px;
  display:inline-flex;
  align-items:center;
  gap:8px;
  border:1px solid var(--border);
  background:var(--surface);
}

.status-badge::before{
  content:'';
  width:8px;
  height:8px;
  border-radius:50%;
  background:var(--text-muted);
  animation:pulse 2s ease-in-out infinite;
}

.status-badge.connected::before{
  background:var(--success);
}

.status-badge.receiving::before{
  background:var(--accent-cyan);
}

@keyframes pulse{
  0%, 100%{opacity:1}
  50%{opacity:0.3}
}

.controls{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:16px;
  margin-bottom:24px;
}

.control-group{
  display:flex;
  flex-direction:column;
  gap:12px;
}

.control-label{
  font-size:11px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:1px;
  color:var(--text-muted);
  margin-bottom:4px;
}

.button-group{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

button{
  padding:12px 24px;
  border-radius:12px;
  border:1px solid var(--border);
  background:var(--surface);
  color:var(--text-primary);
  font-weight:600;
  font-size:14px;
  cursor:pointer;
  transition:all 0.2s ease;
  display:inline-flex;
  align-items:center;
  gap:8px;
  font-family:inherit;
}

button:hover:not(:disabled){
  transform:translateY(-1px);
  box-shadow:var(--shadow-sm);
}

button.primary{
  background:linear-gradient(135deg, var(--accent-cyan), var(--accent-purple));
  border:none;
  color:#fff;
  box-shadow:0 4px 16px rgba(0,212,255,0.3);
}

button.danger{
  background:rgba(239,68,68,0.1);
  border-color:rgba(239,68,68,0.3);
  color:var(--error);
}

button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

.checkbox-label{
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  font-size:14px;
  color:var(--text-secondary);
}

input[type="checkbox"]{
  width:18px;
  height:18px;
  cursor:pointer;
  accent-color:var(--accent-cyan);
}

.metrics-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
  margin-bottom:24px;
}

.metric-card{
  background:linear-gradient(135deg, var(--surface), var(--bg-secondary));
  border:1px solid var(--border);
  border-radius:12px;
  padding:20px;
  text-align:center;
}

.metric-label{
  font-size:11px;
  font-weight:700;
  text-transform:uppercase;
  letter-spacing:1px;
  color:var(--text-muted);
  margin-bottom:8px;
}

.metric-value{
  font-size:32px;
  font-weight:800;
  background:linear-gradient(135deg, var(--accent-cyan), var(--accent-green));
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

.chips-container{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  padding:4px;
}

.chip{
  padding:8px 14px;
  border-radius:8px;
  font-weight:700;
  font-size:13px;
  border:1px solid;
}

.chip.low{
  background:var(--chip-low);
  border-color:var(--accent-cyan);
  color:var(--accent-cyan);
}

.chip.med{
  background:var(--chip-med);
  border-color:var(--accent-purple);
  color:var(--accent-purple);
}

.chip.high{
  background:var(--chip-high);
  border-color:var(--accent-pink);
  color:var(--accent-pink);
}

.table-container{
  overflow-x:auto;
  border-radius:12px;
  border:1px solid var(--border);
}

table{
  width:100%;
  border-collapse:collapse;
}

thead{
  background:var(--bg-secondary);
}

th{
  padding:12px 16px;
  text-align:left;
  font-size:11px;
  font-weight:700;
  text-transform:uppercase;
  color:var(--text-muted);
  border-bottom:1px solid var(--border);
}

td{
  padding:16px;
  border-bottom:1px solid var(--border);
  font-size:14px;
}

tr:hover{
  background:rgba(255,255,255,0.02);
}

.tag{
  padding:4px 10px;
  border-radius:6px;
  font-weight:700;
  font-size:11px;
  text-transform:uppercase;
  border:1px solid;
  display:inline-block;
}

.tag.auto{
  background:rgba(0,212,255,0.15);
  border-color:var(--accent-cyan);
  color:var(--accent-cyan);
}

.tag.triple{
  background:rgba(0,255,136,0.15);
  border-color:var(--accent-green);
  color:var(--accent-green);
}

.tag.rosa{
  background:rgba(255,0,128,0.15);
  border-color:var(--accent-pink);
  color:var(--accent-pink);
}

.state{
  font-weight:700;
  text-transform:uppercase;
  font-size:12px;
}

.state.win{color:var(--success)}
.state.lose{color:var(--error)}
.state.pend{color:var(--warning)}

.log-container{
  height:320px;
  overflow-y:auto;
  background:var(--bg-secondary);
  border:1px solid var(--border);
  border-radius:12px;
  padding:16px;
  font-family:monospace;
  font-size:13px;
  line-height:1.8;
}

.log-entry{
  padding:4px 0;
  color:var(--text-secondary);
}

.log-entry.ok{color:var(--success)}
.log-entry.err{color:var(--error)}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(500px,1fr));
  gap:24px;
}

@media(max-width:1100px){
  .grid{grid-template-columns:1fr;}
}

h2{
  font-size:16px;
  font-weight:700;
  color:var(--text-primary);
  margin-bottom:16px;
  text-transform:uppercase;
  letter-spacing:1px;
}

.alert{
  padding:16px;
  border-radius:12px;
  margin-bottom:16px;
  border-left:4px solid var(--warning);
  background:rgba(245,158,11,0.1);
  color:var(--warning);
  font-size:14px;
}

.session-info{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  margin-bottom:16px;
}

.session-stat{
  padding:6px 12px;
  background:var(--bg-secondary);
  border:1px solid var(--border);
  border-radius:8px;
  font-size:13px;
}

.session-stat strong{
  color:var(--accent-cyan);
}
</style>
</head>
<body>
<div class="container">
  
  <div class="header">
    <div class="brand">
      <div class="logo">G</div>
      <div class="brand-info">
        <h1>Gocho Analyzer v27.0 PRO</h1>
        <p>Sistema de predicci√≥n para 1Win Aviator</p>
      </div>
    </div>
    <div style="display:flex;gap:12px">
      <span class="status-badge" id="statusBadge">Desconectado</span>
      <span class="status-badge" id="dataBadge">Sin datos</span>
      <span class="status-badge" id="clock">--:--:--</span>
    </div>
  </div>

  <div class="alert" id="instructionsAlert">
    <strong>üìã Instrucciones de Uso:</strong><br>
    1. Haz clic en <strong>"Conectar"</strong> aqu√≠ abajo<br>
    2. Ve a la pesta√±a del juego 1Win Aviator<br>
    3. Presiona <strong>F12</strong> para abrir la consola<br>
    4. Copia y pega el <strong>Script Capturador</strong> (ver documentaci√≥n)<br>
    5. Presiona Enter y regresa a esta pesta√±a
  </div>

  <div class="card">
    <h2>Panel de Control</h2>
    <div class="controls">
      
      <div class="control-group">
        <span class="control-label">Conexi√≥n del Sistema</span>
        <div class="button-group">
          <button id="btnConnect" class="primary">üîå Conectar</button>
          <button id="btnDisconnect" class="danger" disabled>‚ùå Desconectar</button>
          <button id="btnTest">‚ñ∂Ô∏è Modo Test</button>
        </div>
      </div>

      <div class="control-group">
        <span class="control-label">Configuraci√≥n</span>
        <div style="display:flex;flex-direction:column;gap:10px">
          <label class="checkbox-label">
            <input id="swBeep" type="checkbox">
            <span>Alertas sonoras</span>
          </label>
          <label class="checkbox-label">
            <input id="swAutoSession" type="checkbox" checked>
            <span>Auto-sesi√≥n (60 rondas)</span>
          </label>
        </div>
      </div>

      <div class="control-group">
        <span class="control-label">Objetivos</span>
        <div style="display:flex;flex-direction:column;gap:10px">
          <label class="checkbox-label">
            <input id="swAuto170" type="checkbox" checked>
            <span>‚â•1.70x (3/sesi√≥n)</span>
          </label>
          <label class="checkbox-label">
            <input id="swAuto3x" type="checkbox" checked>
            <span>‚â•3.0x (3/sesi√≥n)</span>
          </label>
          <label class="checkbox-label">
            <input id="swRosa" type="checkbox" checked>
            <span>‚â•10x ROSA (1-2/sesi√≥n)</span>
          </label>
        </div>
      </div>

    </div>
  </div>

  <div class="metrics-grid">
    <div class="metric-card">
      <div class="metric-label">Heat Score</div>
      <div class="metric-value" id="metricHeat">0.00</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Volatilidad</div>
      <div class="metric-value" id="metricVol">0.00</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Momentum</div>
      <div class="metric-value" id="metricMom">+0.00</div>
    </div>
    <div class="metric-card">
      <div class="metric-label">Gap Rosa</div>
      <div class="metric-value" id="metricGap">99+</div>
    </div>
  </div>

  <div class="card">
    <h2>Historial de Rondas</h2>
    <div class="chips-container" id="chipsContainer">
      <span style="color:var(--text-muted)">Esperando datos...</span>
    </div>
  </div>

  <div class="grid">
    
    <div class="card">
      <h2>Se√±ales Generadas</h2>
      <div class="session-info">
        <div class="session-stat">Sesi√≥n <strong id="sessId">1</strong></div>
        <div class="session-stat">Ronda <strong id="sessRound">0</strong>/60</div>
        <div class="session-stat">1.7x: <strong id="sess170">0</strong>/3</div>
        <div class="session-stat">3x: <strong id="sess3x">0</strong>/3</div>
        <div class="session-stat">Rosa: <strong id="sessRosa">0</strong>/2</div>
      </div>
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>#</th><th>Sesi√≥n</th><th>Ronda</th><th>Tipo</th><th>Objetivo</th><th>Hora</th><th>Crash</th><th>Estado</th>
            </tr>
          </thead>
          <tbody id="signalsTable">
            <tr><td colspan="8" style="text-align:center;color:var(--text-muted);padding:32px">Esperando se√±ales...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h2>Registro del Sistema</h2>
      <div class="log-container" id="logContainer"></div>
    </div>

  </div>

</div>

<script>
const $=s=>document.querySelector(s);
const now=()=>new Date().toLocaleTimeString('es-ES');

function log(msg,cls=''){
  const d=document.createElement('div');
  d.className='log-entry '+(cls||'');
  d.textContent='['+now()+'] '+msg;
  $("#logContainer").appendChild(d);
  $("#logContainer").scrollTop=$("#logContainer").scrollHeight;
}

function tone(f,ms,vol){
  if(!$("#swBeep").checked) return;
  try{
    const a=new AudioContext();
    const o=a.createOscillator(),g=a.createGain();
    o.frequency.value=f;o.type='sine';g.gain.value=vol||0.03;
    o.connect(g).connect(a.destination);
    o.start();setTimeout(()=>o.stop(),ms);
  }catch(e){}
}

setInterval(()=>$("#clock").textContent=now(),1000);

let rounds=[],signals=[],pending=null;
let lastVal=0,lastAt=0,connected=false;
const session={id:1,round:0,used170:0,used3x:0,usedRosa:0};

function updateUI(){
  $("#sessId").textContent=session.id;
  $("#sessRound").textContent=session.round;
  $("#sess170").textContent=session.used170;
  $("#sess3x").textContent=session.used3x;
  $("#sessRosa").textContent=session.usedRosa;
  
  const badge=$("#statusBadge");
  badge.textContent=connected?'Conectado':'Desconectado';
  if(connected) badge.classList.add('connected');
  else badge.classList.remove('connected');
  
  const dataBadge=$("#dataBadge");
  dataBadge.textContent=rounds.length>0?`${rounds.length} rondas`:'Sin datos';
  if(rounds.length>0) dataBadge.classList.add('receiving');
}

function paintChips(){
  const c=$("#chipsContainer");
  if(!rounds.length){c.innerHTML='<span style="color:var(--text-muted)">Esperando datos...</span>';return;}
  c.innerHTML='';
  rounds.slice(0,60).forEach(x=>{
    const sp=document.createElement('span');
    sp.className='chip '+(x<2?'low':x<10?'med':'high');
    sp.textContent=x.toFixed(2)+'x';
    c.appendChild(sp);
  });
}

function renderSignals(){
  const t=$("#signalsTable");
  if(!signals.length){t.innerHTML='<tr><td colspan="8" style="text-align:center;color:var(--text-muted);padding:32px">Esperando se√±ales...</td></tr>';return;}
  t.innerHTML='';
  signals.slice().reverse().slice(0,50).forEach(s=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${s.n}</td><td>${s.sess}</td><td>${s.round}</td>
    <td><span class="tag ${s.tag.includes('ROSA')?'rosa':s.tag.includes('3.0')?'triple':'auto'}">${s.tag}</span></td>
    <td>${s.target.toFixed(2)}x</td><td>${s.time}</td>
    <td>${s.crash==='‚Äî'?'‚Äî':s.crash.toFixed(2)+'x'}</td>
    <td><span class="state ${s.state}">${s.state}</span></td>`;
    t.appendChild(tr);
  });
}

function norm(x,a,b){return Math.max(0,Math.min(1,(x-a)/(b-a||1)))}
function calcStdDev(a){if(a.length<2)return 0;const m=a.reduce((x,y)=>x+y,0)/a.length;return Math.sqrt(a.reduce((x,y)=>x+Math.pow(y-m,2),0)/a.length);}
function calcVol(){const a=rounds.slice(0,30);if(a.length<10)return 0;const m=a.reduce((x,y)=>x+y,0)/a.length;return m>0?Math.min(1,calcStdDev(a)/m):0;}
function calcMom(){const a=rounds.slice(0,25);if(a.length<16)return 0;return a.slice(0,8).reduce((x,y)=>x+y,0)/8-a.slice(8,16).reduce((x,y)=>x+y,0)/8;}

function heatScore170(){
  const a=rounds.slice(0,30);if(a.length<15)return 0;
  const ma10=a.slice(0,10).reduce((x,y)=>x+y,0)/10,p2=a.filter(x=>x>=2).length/a.length,mom=calcMom(),vol=calcVol();
  const trap=a.slice(0,4).reduce((x,y)=>x+y,0)/4<1.40?0.35:0,vb=(vol>0.25&&vol<0.6)?0.08:0;
  return Math.max(0,Math.min(1.2,0.40*norm(ma10,1.5,3.2)+0.25*norm(p2,0.15,0.65)+0.20*norm(mom,-0.4,0.9)+vb-trap));
}

function heatScore3X(){
  const a=rounds.slice(0,35);if(a.length<20)return 0;
  const ma10=a.slice(0,10).reduce((x,y)=>x+y,0)/10,p3=a.filter(x=>x>=3).length/a.length,mom=calcMom();
  const hot=(ma10>2.8&&a.slice(0,8).filter(x=>x>=2.5).length>=5)?0.15:0,lp=a.slice(0,10).filter(x=>x<1.5).length>=5?0.25:0;
  return Math.max(0,Math.min(1.2,0.45*norm(ma10,2.0,4.0)+0.30*norm(p3,0.05,0.40)+0.18*norm(mom,0,1.2)+hot-lp));
}

function rosaScore(){
  const a=rounds.slice(0,100);if(a.length<45)return 0;
  const gap=a.findIndex(x=>x>=10),g=gap<0?99:gap,ma15=a.slice(0,15).reduce((x,y)=>x+y,0)/15;
  const p2=a.slice(0,40).filter(x=>x>=2).length/40,mom=calcMom(),vol=calcVol();
  const gb=g>=30?0.18:(g>=20?0.10:0),vr=vol>=0.45?0.15:-0.20;
  return Math.max(0,Math.min(1.3,0.30*norm(ma15,1.8,3.8)+0.25*norm(p2,0.20,0.70)+0.20*norm(mom,0.2,1.0)+vr+gb));
}

function updateMetrics(){
  const h1=heatScore170(),h3=heatScore3X(),hr=rosaScore(),vol=calcVol(),mom=calcMom();
  const gap=rounds.slice(0,100).findIndex(x=>x>=10);
  $("#metricHeat").textContent=Math.max(h1,h3,hr).toFixed(2);
  $("#metricVol").textContent=vol.toFixed(2);
  $("#metricMom").textContent=(mom>=0?'+':'')+mom.toFixed(2);
  $("#metricGap").textContent=gap<0?'99+':gap;
}

function maybe170(){
  if(!$("#swAuto170").checked||session.used170>=3)return;
  const h=heatScore170(),slot=session.used170===0?[5,22]:session.used170===1?[23,42]:[43,58];
  const ok=(session.round>=slot[0]&&session.round<=slot[1]&&h>=0.65)||h>=0.90;
  if(ok){
    pending={tag:'AUTO_1.70X',target:1.70,sess:session.id,enterAt:session.round+1};
    session.used170++;
    signals.push({n:signals.length+1,sess:session.id,round:session.round,tag:'AUTO_1.70X',target:1.70,time:now(),crash:'‚Äî',state:'pend'});
    renderSignals();
    log(`üéØ Se√±al ‚â•1.70x emitida (T+1). Heat=${h.toFixed(2)}`,'ok');
    tone(940,140,0.035);
  }
}

function maybe3X(){
  if(!$("#swAuto3x").checked||session.used3x>=3)return;
  const h=heatScore3X(),slot=session.used3x===0?[8,24]:session.used3x===1?[25,44]:[45,58];
  const ok=(session.round>=slot[0]&&session.round<=slot[1]&&h>=0.68)||h>=0.95;
  if(ok){
    pending={tag:'AUTO_3.0X',target:3.0,sess:session.id,enterAt:session.round+1};
    session.used3x++;
    signals.push({n:signals.length+1,sess:session.id,round:session.round,tag:'AUTO_3.0X',target:3.0,time:now(),crash:'‚Äî',state:'pend'});
    renderSignals();
    log(`üéØ Se√±al ‚â•3.0x emitida (T+1). Heat=${h.toFixed(2)}`,'ok');
    tone(820,150,0.04);
  }
}

function maybeRosa(){
  if(!$("#swRosa").checked||session.usedRosa>=2)return;
  const rs=rosaScore(),gap=rounds.slice(0,100).findIndex(x=>x>=10),vol=calcVol();
  const ok=(gap<0||gap>=25)&&vol>=0.45&&rs>=0.92&&session.round>=12&&session.round<=55;
  if(ok){
    pending={tag:'ROSA_10X',target:10.0,sess:session.id,enterAt:session.round+1};
    session.usedRosa++;
    signals.push({n:signals.length+1,sess:session.id,round:session.round,tag:'ROSA_10X',target:10,time:now(),crash:'‚Äî',state:'pend'});
    renderSignals();
    log(`üåπ ROSA armada (T+1). Score=${rs.toFixed(2)} Gap=${gap<0?'99+':gap}`,'ok');
    tone(520,140,0.045);setTimeout(()=>tone(820,160,0.04),160);
  }
}

function ingest(x){
  const v=parseFloat(x);if(!isFinite(v)||v<=0)return;
  const t=performance.now();if(v===lastVal&&(t-lastAt)<2500)return;
  lastVal=v;lastAt=t;

  rounds.unshift(v);if(rounds.length>200)rounds.pop();
  session.round++;

  if(session.round>60){
    if($("#swAutoSession").checked){
      session.id++;session.round=1;session.used170=0;session.used3x=0;session.usedRosa=0;
      log(`üìä Nueva sesi√≥n ${session.id}`,'ok');
    }else session.round=60;
  }

  updateUI();paintChips();updateMetrics();

  if(pending&&pending.sess===session.id&&pending.enterAt===session.round){
    const win=v>=pending.target,state=win?'win':'lose';
    const sig=signals.find(s=>s.sess===pending.sess&&s.round===pending.enterAt&&s.state==='pend');
    if(sig){sig.state=state;sig.crash=v;renderSignals();}
    const roi=win?((v/pending.target)*100-100).toFixed(1):'-100';
    log(`${pending.tag} ${state.toUpperCase()} ‚Ä¢ ${v.toFixed(2)}x ‚Ä¢ ROI:${roi}%`,state==='win'?'ok':'err');
    pending=null;
  }

  maybeRosa();maybe3X();maybe170();
}

let bc1,bc2,poll;

function connect(){
  if(connected)return;
  try{
    bc1=new BroadcastChannel('gocho');
    bc1.onmessage=e=>ingest(e.data);
    bc2=new BroadcastChannel('aviator');
    bc2.onmessage=e=>ingest(e.data);
  }catch(e){log('Error BC: '+e.message,'err');}

  window.addEventListener('storage',e=>{
    if((e.key==='gocho:round'||e.key==='aviator:round')&&e.newValue)ingest(parseFloat(e.newValue));
  });

  poll=setInterval(()=>{
    const v=localStorage.getItem('gocho:round')||localStorage.getItem('aviator:round');
    if(v)ingest(parseFloat(v));
  },500);

  connected=true;
  $("#btnConnect").disabled=true;
  $("#btnDisconnect").disabled=false;
  $("#instructionsAlert").style.display='none';
  updateUI();
  log('‚úÖ Sistema conectado','ok');
  tone(1200,100,0.03);
}

function disconnect(){
  if(!connected)return;
  try{bc1&&bc1.close();bc2&&bc2.close();}catch(e){}
  clearInterval(poll);
  connected=false;
  $("#btnConnect").disabled=false;
  $("#btnDisconnect").disabled=true;
  $("#instructionsAlert").style.display='block';
  updateUI();
  log('‚õî Desconectado','err');
}

function test(){
  log('üß™ Modo test activado','ok');
  const seq=[()=>1+Math.random()*1.2,()=>1.2+Math.random()*5.3,()=>10+Math.random()*40];
  setInterval(()=>{
    const v=seq[Math.random()<.1?2:(Math.random()<.6?0:1)]();
    ingest(parseFloat(v.toFixed(2)));
  },1200);
}

$("#btnConnect").onclick=connect;
$("#btnDisconnect").onclick=disconnect;
$("#btnTest").onclick=test;

updateUI();
log('Sistema iniciado. Haz clic en Conectar.','');
</script>
</body>
</html>
