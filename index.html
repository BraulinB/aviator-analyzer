<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Aviator Analyzer Cloud</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <style>
    body{background:#2d185f;color:#fff;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;padding:6px;}
    .container{max-width:800px;margin:0 auto;}
    .header{text-align:center;padding:16px;margin-bottom:13px;}
    .cloud-badge{display:inline-block;background:rgba(30,255,30,0.12);padding:4px 11px;border-radius:12px;}
    .main-section{display:grid;grid-template-columns:2fr 1fr;gap:13px;margin-bottom:10px;}
    .panel{background:rgba(0,0,0,0.19);border-radius:11px;padding:17px 0;text-align:center;}
    .stats-section{background:rgba(255,255,255,0.09);border-radius:7px;padding:11px;}
    .signal-section{background:rgba(255,255,255,0.07);margin-bottom:8px;border-radius:9px;padding:8px;}
    .history-section{background:rgba(255,255,255,0.06);border-radius:8px;padding:10px;}
    .signal-item{padding:8px 6px 7px 12px;border-left:4px solid #4172c2;background:#14062f;border-radius:6px;margin-bottom:7px;}
    .signal-item.ganada{border-left-color:#00fd84;background:rgba(0,253,132,0.09);}
    .signal-item.perdida{border-left-color:#fd175c;background:rgba(253,23,92,0.10);}
    .signal-header{font-weight:bold;}
    @media (max-width:780px){.main-section{grid-template-columns:1fr;}}
  </style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Aviator Analyzer Pro</h1>
    <div class="cloud-badge" id="syncState">‚òÅÔ∏è Conectando...</div>
  </div>
  
  <div id="loginPanel" style="max-width:350px;margin:35px auto 0 auto;background:rgba(0,0,0,0.19);border-radius:9px;padding:20px 30px;">
    <h3>Iniciar sesi√≥n</h3>
    <input id="email" type="email" placeholder="Correo electr√≥nico" style="width:100%;margin-bottom:8px;padding:5px;">
    <input id="pass" type="password" placeholder="Contrase√±a" style="width:100%;margin-bottom:10px;padding:5px;">
    <button onclick="login()" style="background:#2690ff;color:white;width:100%;padding:8px;border:none;border-radius:7px;">Entrar</button>
    <div id="loginError" style="color:#fd175c;font-size:.93em;margin-top:12px;"></div>
    <div style="margin-top:8px;text-align:center;"><a href="#" onclick="registerUser();return false;" style="color:#00efc8;font-size:.96em;">Crear cuenta</a></div>
  </div>
  
  <!-- El resto de la app va oculto hasta loguear -->
  <div id="appContent" style="display:none;">
    <div class="main-section">
      <div>
        <div class="signal-section" id="signalPanel">Cargando...</div>
        <div class="history-section">
          <h4>Historial de Se√±ales</h4>
          <div id="signalList"></div>
        </div>
      </div>
      <div class="stats-section">
        <h4>Estad√≠sticas</h4>
        <div>Se√±ales totales: <span id="statSignals">0</span></div>
        <div>Ganadas: <span id="statGanadas">0</span></div>
        <div>Perdidas: <span id="statPerdidas">0</span></div>
        <div>% Acierto: <span id="statAcierto">--</span></div>
        <button onclick="cerrarSesion()" style="background:#fd175c;color:white;padding:6px 18px;margin-top:20px;">Cerrar sesi√≥n</button>
      </div>
    </div>
  </div>
</div>
<script>
// --- CONFIGURA FIREBASE ---
const firebaseConfig = {
  apiKey: "AlzaSyDuEnNg5XutDF3Ka90o6GFKTazBLR9NnSs",
  authDomain: "aviator-analyzer-b29a7.firebaseapp.com",
  projectId: "aviator-analyzer-b29a7",
  storageBucket: "aviator-analyzer-b29a7.appspot.com",
  messagingSenderId: "575063626276",
  appId: "1:575063626276:web:dc0f8c2b1cf8e2f9bb4f91",
  databaseURL: "https://aviator-analyzer-b29a7-default-rtdb.firebaseio.com"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let UID = null;
let refSenales = null;
let se√±alesActuales = [];
let listenerSenales = null;

function login() {
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('pass').value.trim();
  document.getElementById('loginError').textContent = "";
  auth.signInWithEmailAndPassword(email, pass)
    .then(res => {/*nada, manejado por onAuthStateChanged*/})
    .catch(err => {
      document.getElementById('loginError').textContent = "Error: " + (err.code === "auth/user-not-found" ? "El usuario no existe." : err.message);
    });
}

function registerUser() {
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('pass').value.trim();
  document.getElementById('loginError').textContent = "";
  if (pass.length < 6) { document.getElementById('loginError').textContent = "Contrase√±a debe tener m√≠nimo 6 caracteres."; return;}
  auth.createUserWithEmailAndPassword(email, pass)
    .then(res=>{document.getElementById('loginError').textContent="Cuenta creada, ¬°puedes entrar!";})
    .catch(err => {
      document.getElementById('loginError').textContent = "Error: " + (err.code === "auth/email-already-in-use" ? "Ya existe un usuario con ese email." : err.message);
    });
}

function cerrarSesion() {
  auth.signOut();
}

auth.onAuthStateChanged(user => {
  if (user) {
    UID = user.uid;
    document.getElementById('appContent').style.display = '';
    document.getElementById('loginPanel').style.display = 'none';
    document.getElementById('syncState').textContent = "‚òÅÔ∏è Sincronizado (" + user.email + ")";
    iniciarSesion();
  } else {
    UID = null;
    if (listenerSenales && refSenales) refSenales.off('value',listenerSenales);
    document.getElementById('appContent').style.display='none';
    document.getElementById('loginPanel').style.display='';
    document.getElementById('syncState').textContent = "‚òÅÔ∏è Por iniciar sesi√≥n";
  }
});

// -- L√ìGICA DE SE√ëALES GLOBAL SYNC --
function iniciarSesion() {
  // Se√±ales y resultados "globally shared" por usuario
  refSenales = db.ref('usuarios/'+UID+'/senales');
  listenerSenales = refSenales.on('value',snap=>{
    se√±alesActuales = [];
    snap.forEach(child=>{
      se√±alesActuales.push(child.val());
    });
    renderizaTodo();
  });
}

function renderizaTodo() {
  // Panel se√±al actual o pendiente
  let senalActiva = se√±alesActuales.find(s=>s.resultado==='PENDIENTE');
  if (senalActiva) {
    document.getElementById('signalPanel').innerHTML = `<b>üîî Se√±al Activa</b><br>
      Rango: <b>${senalActiva.rango}</b><br>
      Confianza: <b>${senalActiva.confianza || "--"}%</b><br>
      Estado: <span style="color:gold;">Pendiente</span>`;
  } else {
    document.getElementById('signalPanel').innerHTML =
      "<span style='color:#9dffe5;'>Esperando nueva se√±al...</span>";
  }

  // Historial (siempre igual en cualquier dispositivo/logueo)
  let html = "";
  let ganadas = 0, perdidas = 0;
  se√±alesActuales.slice().reverse().forEach((s,idx)=>{
    let icon = (s.resultado==="GANADA")?"‚úÖ":"‚ùå";
    let clase = (s.resultado==="GANADA")?"ganada":(s.resultado==="PERDIDA")?"perdida":"";
    if (s.resultado==="GANADA") ganadas++; else if (s.resultado==="PERDIDA") perdidas++;
    html += `<div class="signal-item ${clase}">
      <div class="signal-header">Se√±al #${se√±alesActuales.length-idx}</div>
      <div>Rango: ${s.rango||"--"}</div>
      <div>Confianza: ${(s.confianza||"--")+"%"}</div>
      <div>Estado: <b>${icon} ${s.resultado||"Pendiente"}</b></div>
      ${s.resultadoReal?'<div>Real: '+s.resultadoReal+'</div>':''}
    </div>`;
  });
  document.getElementById('signalList').innerHTML = html || "<i>Sin se√±ales a√∫n.</i>";
  
  // Stats
  document.getElementById('statSignals').textContent = se√±alesActuales.length;
  document.getElementById('statGanadas').textContent = ganadas;
  document.getElementById('statPerdidas').textContent = perdidas;
  document.getElementById('statAcierto').textContent = se√±alesActuales.length ?
    Math.round(ganadas / se√±alesActuales.length * 100)+'%' : '--';  
}

</script>
</body>
</html>
