<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aviator Analyzer Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI'; background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%); color: #fff; min-height: 100vh; padding: 8px; }
        .container { width: 100%; max-width: 100%; }
        .header { text-align: center; padding: 10px; background: rgba(255, 255, 255, 0.08); border-radius: 8px; margin-bottom: 8px; }
        .header h1 { font-size: 1.3em; margin-bottom: 5px; }
        .status { display: inline-block; padding: 5px 12px; background: rgba(0, 255, 0, 0.2); border-radius: 15px; font-size: 0.8em; }
        .crashes { background: rgba(255, 255, 255, 0.06); border-radius: 8px; padding: 8px; margin-bottom: 8px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .crashes h3 { font-size: 0.8em; margin-bottom: 6px; opacity: 0.8; }
        .crashes-grid { display: grid; grid-template-columns: repeat(15, 1fr); gap: 3px; max-height: 80px; overflow-y: auto; }
        .crash { padding: 5px 3px; text-align: center; font-size: 0.65em; border-radius: 3px; font-weight: bold; border: 1px solid rgba(255, 255, 255, 0.2); }
        .crash.azul { background: rgba(0, 212, 255, 0.2); color: #00d4ff; }
        .crash.verde { background: rgba(3, 218, 198, 0.2); color: #03dac6; }
        .crash.morado { background: rgba(187, 134, 252, 0.2); color: #bb86fc; }
        .crash.fucsia { background: rgba(255, 20, 147, 0.3); color: #ff1493; }
        .main { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 8px; margin-bottom: 8px; }
        .panel { background: rgba(255, 255, 255, 0.06); border-radius: 8px; padding: 12px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .signal-box { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; padding: 15px; text-align: center; min-height: 120px; display: flex; flex-direction: column; justify-content: center; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5); border: 2px solid rgba(255, 255, 255, 0.2); }
        .signal-box.hot { background: linear-gradient(135deg, #00ff88, #00cc88); animation: glow 1.5s infinite; }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.6); } 50% { box-shadow: 0 0 40px rgba(0, 255, 136, 0.9); } }
        .signal-box.blocked { background: linear-gradient(135deg, #ff0000, #8b0000); }
        .sig-state { font-size: 0.9em; margin-bottom: 5px; }
        .sig-range { font-size: 1.6em; font-weight: bold; margin: 8px 0; }
        .sig-info { font-size: 0.8em; margin-top: 8px; opacity: 0.9; }
        .stat { background: rgba(255, 255, 255, 0.05); padding: 8px; border-radius: 5px; margin-bottom: 6px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.1); }
        .stat-val { font-size: 1.3em; font-weight: bold; color: #667eea; }
        .stat-label { font-size: 0.7em; opacity: 0.6; margin-top: 2px; }
        .chart { width: 100%; height: 110px; }
        .trend-label { font-size: 0.75em; margin-bottom: 5px; opacity: 0.8; }
        .history { background: rgba(255, 255, 255, 0.06); border-radius: 8px; padding: 10px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .history h3 { font-size: 0.8em; margin-bottom: 8px; opacity: 0.8; }
        .signal-item { padding: 7px; margin: 4px 0; background: #1a1a2e; border-radius: 4px; border-left: 3px solid #667eea; font-size: 0.7em; }
        .signal-item.win { border-left-color: #00ff00; background: rgba(0, 255, 0, 0.08); }
        .signal-item.lose { border-left-color: #ff0000; background: rgba(255, 0, 0, 0.08); }
        .badge { display: inline-block; padding: 2px 6px; border-radius: 3px; font-size: 0.65em; font-weight: bold; margin-left: 5px; }
        .badge.win { background: rgba(0, 255, 0, 0.3); color: #00ff00; }
        .badge.lose { background: rgba(255, 0, 0, 0.3); color: #ff0000; }
        .badge.pending { background: rgba(255, 165, 0, 0.3); color: #ffa500; }
        footer { text-align: center; padding: 8px; margin-top: 10px; opacity: 0.5; font-size: 0.75em; }
        .btn-group { display: flex; gap: 5px; margin-top: 8px; }
        button { padding: 6px 12px; border: none; border-radius: 4px; font-size: 0.75em; cursor: pointer; font-weight: bold; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-secondary { background: rgba(255, 255, 255, 0.1); color: white; border: 1px solid rgba(255, 255, 255, 0.2); }
        @media (max-width: 1200px) { .main { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) { .main { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Aviator Analyzer Pro</h1>
            <div class="status" id="status">‚è≥ Iniciando...</div>
        </div>

        <div class="crashes">
            <h3>üìä √öltimas Rondas</h3>
            <div class="crashes-grid" id="crashGrid"></div>
        </div>

        <div class="main">
            <div class="panel">
                <div class="signal-box" id="sigBox">
                    <div>‚è≥ Cargando datos...</div>
                </div>
            </div>

            <div class="panel">
                <div class="trend-label">üìà Tendencia</div>
                <canvas class="chart" id="trendChart"></canvas>
                <div class="stat">
                    <div class="stat-label">Estado</div>
                    <div class="stat-val" id="trendState">---</div>
                </div>
            </div>

            <div class="panel">
                <div class="trend-label">üìä Estad√≠sticas</div>
                <div class="stat">
                    <div class="stat-label">Rondas</div>
                    <div class="stat-val" id="statRounds">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Se√±ales</div>
                    <div class="stat-val" id="statSignals">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Ganadas</div>
                    <div class="stat-val" id="statWon">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">% Win</div>
                    <div class="stat-val" id="statWin">--%</div>
                </div>
                <div class="btn-group">
                    <button class="btn-primary" onclick="location.reload()">üîÑ Reiniciar</button>
                </div>
            </div>
        </div>

        <div class="history">
            <h3>üéØ Historial de Se√±ales</h3>
            <div id="historyBox"></div>
        </div>

        <footer>Aviator Analyzer Pro v11.0 - INTELIGENCIA REAL</footer>
    </div>

    <script>
        const config = {
            apiKey: "AlzaSyDuEnNg5XutDF3Ka90o6GFKTazBLR9NnSs",
            authDomain: "aviator-analyzer-b29a7.firebaseapp.com",
            projectId: "aviator-analyzer-b29a7",
            storageBucket: "aviator-analyzer-b29a7.appspot.com",
            messagingSenderId: "575063626276",
            appId: "1:575063626276:web:dc0f8c2b1cf8e2f9bb4f91",
            databaseURL: "https://aviator-analyzer-b29a7-default-rtdb.firebaseio.com"
        };

        firebase.initializeApp(config);
        const db = firebase.database();

        class Analyzer {
            constructor() {
                this.crashes = [];
                this.signals = [];
                this.waitCount = 0;
                this.status = "init";
                this.init();
            }

            init() {
                db.ref('feeds/gocho/crashes').orderByKey().limitToLast(60).once('value', snap => {
                    let data = [];
                    snap.forEach(child => {
                        const v = child.val();
                        if (v && v.v && v.ts) data.push({ val: v.v, ts: v.ts, key: child.key });
                    });
                    data.sort((a, b) => a.ts - b.ts);
                    this.crashes = data;
                    this.status = "ready";
                    this.update();
                    document.getElementById('status').textContent = "‚úÖ Conectado (60 rondas cargadas)";

                    db.ref('feeds/gocho/crashes').on('child_added', s => {
                        const v = s.val();
                        if (v && v.v && v.ts && !this.crashes.find(c => c.key === s.key)) {
                            this.crashes.push({ val: v.v, ts: v.ts, key: s.key });
                            if (this.crashes.length > 60) this.crashes.shift();
                            this.update();
                        }
                    });
                });
            }

            categorize(val) {
                if (val < 1.5) return 'azul';
                if (val < 2.0) return 'verde';
                if (val < 10.0) return 'morado';
                return 'fucsia';
            }

            analyzeTrend() {
                if (this.crashes.length < 20) return { type: 'wait', label: 'Recopilando...', emoji: '‚è≥' };

                const last20 = this.crashes.slice(-20);
                const cats = last20.map(c => this.categorize(c.val));
                
                const morados = cats.filter(c => c === 'morado' || c === 'fucsia').length;
                const azules = cats.filter(c => c === 'azul').length;
                const greens = cats.filter(c => c === 'verde').length;

                // ALCISTA: Mayor√≠a morados/fusia, pocos azules
                if (morados >= 11 && azules <= 3) {
                    return { type: 'bullish', label: 'üìà ALCISTA', emoji: 'üü¢', conf: 78 };
                }

                // BAJISTA: Muchos azules
                if (azules >= 7) {
                    return { type: 'bearish', label: 'üìâ BAJISTA', emoji: 'üî¥', conf: 0 };
                }

                // ESTABLE: Mezcla
                if (morados >= 8 && azules <= 5) {
                    return { type: 'stable', label: '‚ÜîÔ∏è ESTABLE', emoji: 'üü°', conf: 65 };
                }

                return { type: 'neutral', label: '‚ö™ NEUTRAL', emoji: '‚ö™', conf: 55 };
            }

            shouldSignal() {
                if (this.status !== 'ready') return false;
                if (this.signals.length > 0 && !this.signals[this.signals.length - 1].result) return false;

                const trend = this.analyzeTrend();
                if (trend.type === 'bearish') return false;

                this.waitCount++;

                const waitReq = trend.type === 'bullish' ? 3 : 6;
                return this.waitCount >= waitReq;
            }

            getSignalRange() {
                const last20 = this.crashes.slice(-20);
                const avg = last20.reduce((a, c) => a + c.val, 0) / 20;
                const trend = this.analyzeTrend();

                let min, max;

                if (trend.type === 'bullish') {
                    min = avg * 0.85;
                    max = avg * 1.3;
                } else if (trend.type === 'stable') {
                    min = avg * 0.8;
                    max = avg * 1.2;
                } else {
                    min = Math.max(1.8, avg * 0.7);
                    max = Math.max(2.8, avg * 1.1);
                }

                return { min: Math.max(1.5, min).toFixed(2), max: Math.max(2.5, max).toFixed(2), conf: trend.conf };
            }

            update() {
                this.renderCrashes();
                this.renderSignal();
                this.renderChart();
                this.renderStats();
                this.renderHistory();
            }

            renderCrashes() {
                const grid = document.getElementById('crashGrid');
                const html = this.crashes.slice(-60).reverse().map(c => 
                    `<div class="crash ${this.categorize(c.val)}">${c.val.toFixed(2)}</div>`
                ).join('');
                grid.innerHTML = html || '<p>Cargando...</p>';
            }

            renderSignal() {
                const box = document.getElementById('sigBox');
                const trend = this.analyzeTrend();

                if (trend.type === 'bearish') {
                    box.className = 'signal-box blocked';
                    box.innerHTML = `<div>üö´ ZONA PELIGROSA - ESPERANDO</div>`;
                    return;
                }

                if (this.shouldSignal()) {
                    const range = this.getSignalRange();
                    this.signals.push({ min: range.min, max: range.max, result: null, conf: range.conf });
                    this.waitCount = 0;
                    
                    box.className = 'signal-box hot';
                    box.innerHTML = `
                        <div class="sig-state">${trend.emoji} ‚úÖ SE√ëAL ACTIVA</div>
                        <div class="sig-range">${range.min}x - ${range.max}x</div>
                        <div class="sig-info">Confianza: ${range.conf}% | ${trend.label}</div>
                    `;
                } else {
                    box.className = 'signal-box';
                    box.innerHTML = `<div class="sig-state">${trend.emoji}</div><div class="sig-range" style="font-size: 1.2em;">‚è≥ ${this.waitCount}/${trend.type === 'bullish' ? 3 : 6}</div><div class="sig-info">${trend.label}</div>`;
                }

                // Verificar se√±al pendiente
                if (this.signals.length > 0 && !this.signals[this.signals.length - 1].result && this.signals[this.signals.length - 1].checked !== 1) {
                    const sig = this.signals[this.signals.length - 1];
                    const last = this.crashes[this.crashes.length - 1].val;
                    
                    if (last >= parseFloat(sig.min) && last <= parseFloat(sig.max)) {
                        sig.result = 'WIN';
                        sig.real = last.toFixed(2);
                    } else if (this.waitCount >= 2) {
                        sig.result = 'LOSE';
                        sig.real = last.toFixed(2);
                    }
                    sig.checked = 1;
                }
            }

            renderChart() {
                const canvas = document.getElementById('trendChart');
                const ctx = canvas.getContext('2d');
                canvas.width = canvas.offsetWidth;
                canvas.height = 110;
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (this.crashes.length < 2) return;

                const data = this.crashes.slice(-30);
                const max = Math.max(...data.map(c => c.val), 10);

                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                data.forEach((c, i) => {
                    const x = (i / (data.length - 1)) * canvas.width;
                    const y = canvas.height - (c.val / max * (canvas.height - 10));
                    i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                });
                ctx.stroke();

                const trend = this.analyzeTrend();
                document.getElementById('trendState').textContent = trend.label;
            }

            renderStats() {
                document.getElementById('statRounds').textContent = this.crashes.length;
                document.getElementById('statSignals').textContent = this.signals.length;
                const wins = this.signals.filter(s => s.result === 'WIN').length;
                document.getElementById('statWon').textContent = wins;
                const wr = this.signals.length > 0 ? Math.round((wins / this.signals.length) * 100) : 0;
                document.getElementById('statWin').textContent = `${wr}%`;
            }

            renderHistory() {
                const box = document.getElementById('historyBox');
                if (this.signals.length === 0) {
                    box.innerHTML = '<p style="opacity: 0.5; font-size: 0.75em;">Sin se√±ales...</p>';
                    return;
                }
                const html = [...this.signals].reverse().map((s, i) => {
                    const status = s.result ? (s.result === 'WIN' ? 'win' : 'lose') : 'pending';
                    const text = s.result ? (s.result === 'WIN' ? '‚úÖ GANADA' : '‚ùå PERDIDA') : '‚è≥ PENDIENTE';
                    return `<div class="signal-item ${status}"><strong>Se√±al ${this.signals.length - i}</strong> | ${s.min}x - ${s.max}x ${s.real ? `| Real: ${s.real}x` : ''}<span class="badge ${status}">${text}</span></div>`;
                }).join('');
                box.innerHTML = html;
            }
        }

        const analyzer = new Analyzer();
        setInterval(() => analyzer.update(), 500);
    </script>
</body>
</html>
