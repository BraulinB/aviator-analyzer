<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator Analyzer</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI';background:linear-gradient(135deg, #0f0c29 0%, #302b63 100%);color:#fff;min-height:100vh;padding:10px}
        .container{max-width:100%;margin:0 auto}
        h1{text-align:center;margin-bottom:10px;font-size:1.5em}
        .status{text-align:center;padding:8px;background:rgba(0,255,0,0.2);border-radius:8px;margin-bottom:10px;font-size:0.9em}
        .crashes{background:rgba(255,255,255,0.06);padding:10px;border-radius:8px;margin-bottom:10px;border:1px solid rgba(255,255,255,0.1)}
        .crashes h3{font-size:0.9em;margin-bottom:8px}
        .crash-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(40px, 1fr));gap:3px}
        .crash{padding:5px;text-align:center;font-size:0.65em;border-radius:4px;font-weight:bold;border:1px solid}
        .crash.azul{background:rgba(0,212,255,0.2);border-color:#00d4ff;color:#00d4ff}
        .crash.verde{background:rgba(3,218,198,0.2);border-color:#03dac6;color:#03dac6}
        .crash.morado{background:rgba(187,134,252,0.2);border-color:#bb86fc;color:#bb86fc}
        .crash.fucsia{background:rgba(255,20,147,0.3);border-color:#ff1493;color:#ff1493}
        .grid{display:grid;grid-template-columns:2fr 1fr;gap:10px;margin-bottom:10px}
        .panel{background:rgba(255,255,255,0.06);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1)}
        .signal{background:linear-gradient(135deg,#667eea,#764ba2);padding:15px;border-radius:8px;text-align:center;min-height:110px;display:flex;flex-direction:column;justify-content:center}
        .signal.hot{background:linear-gradient(135deg,#00ff88,#00cc88)}
        .signal.blocked{background:linear-gradient(135deg,#ff0000,#8b0000)}
        .signal-text{font-size:0.9em;margin-bottom:5px}
        .signal-value{font-size:1.8em;font-weight:bold;margin:10px 0}
        .signal-info{font-size:0.85em;opacity:0.9}
        .stat{background:rgba(255,255,255,0.05);padding:10px;margin-bottom:8px;border-radius:5px;text-align:center;border:1px solid rgba(255,255,255,0.1)}
        .stat-val{font-size:1.4em;font-weight:bold;color:#667eea;margin:5px 0}
        .stat-label{font-size:0.75em;opacity:0.7}
        .chart{width:100%;height:120px}
        .history{background:rgba(255,255,255,0.06);padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.1)}
        .history h3{margin-bottom:10px;font-size:0.9em}
        .sig-item{padding:8px;margin:5px 0;background:#1a1a2e;border-radius:4px;border-left:3px solid #667eea;font-size:0.75em}
        .sig-item.win{border-left-color:#00ff00;background:rgba(0,255,0,0.08)}
        .sig-item.lose{border-left-color:#ff0000;background:rgba(255,0,0,0.08)}
        .badge{display:inline-block;padding:2px 8px;border-radius:3px;font-size:0.7em;font-weight:bold;margin-left:10px}
        .badge.win{background:rgba(0,255,0,0.3);color:#00ff00}
        .badge.lose{background:rgba(255,0,0,0.3);color:#ff0000}
        .badge.pending{background:rgba(255,165,0,0.3);color:#ffa500}
        footer{text-align:center;opacity:0.5;font-size:0.8em;margin-top:15px}
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Aviator Analyzer Pro</h1>
        <div class="status" id="status">‚è≥ Conectando...</div>

        <div class="crashes">
            <h3>üìä √öltimas Rondas</h3>
            <div class="crash-grid" id="crashGrid"></div>
        </div>

        <div class="grid">
            <div class="panel">
                <div class="signal" id="signal">
                    <div>‚è≥ Cargando...</div>
                </div>
            </div>
            <div class="panel">
                <h3 style="font-size:0.9em;margin-bottom:8px">üìä Datos</h3>
                <div class="stat">
                    <div class="stat-label">Rondas</div>
                    <div class="stat-val" id="rounds">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Se√±ales</div>
                    <div class="stat-val" id="signals">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Ganadas</div>
                    <div class="stat-val" id="won">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">% Win</div>
                    <div class="stat-val" id="wr">--%</div>
                </div>
            </div>
        </div>

        <div class="history">
            <h3>üéØ Historial</h3>
            <div id="history" style="max-height:250px;overflow-y:auto"></div>
        </div>

        <footer>Aviator Analyzer Pro - FINAL</footer>
    </div>

    <script>
        const config = {
            apiKey: "AlzaSyDuEnNg5XutDF3Ka90o6GFKTazBLR9NnSs",
            authDomain: "aviator-analyzer-b29a7.firebaseapp.com",
            projectId: "aviator-analyzer-b29a7",
            storageBucket: "aviator-analyzer-b29a7.appspot.com",
            messagingSenderId: "575063626276",
            appId: "1:575063626276:web:dc0f8c2b1cf8e2f9bb4f91",
            databaseURL: "https://aviator-analyzer-b29a7-default-rtdb.firebaseio.com"
        };

        firebase.initializeApp(config);
        const db = firebase.database();

        let crashes = [];
        let signals = [];
        let wait = 0;
        let loaded = false;

        function cat(v) {
            if (v < 1.5) return 'azul';
            if (v < 2.0) return 'verde';
            if (v < 10) return 'morado';
            return 'fucsia';
        }

        function trend() {
            if (crashes.length < 20) return { type: 'load', label: 'Cargando', emoji: '‚è≥', ok: false };

            const last20 = crashes.slice(-20);
            const morados = last20.filter(c => {const x = cat(c); return x === 'morado' || x === 'fucsia'}).length;
            const azules = last20.filter(c => cat(c) === 'azul').length;

            if (morados >= 11 && azules <= 3) return { type: 'bull', label: 'üìà ALCISTA', emoji: 'üü¢', ok: true, wait: 3, conf: 78 };
            if (azules >= 7) return { type: 'bear', label: 'üìâ BAJISTA', emoji: 'üî¥', ok: false, wait: 0, conf: 0 };
            if (morados >= 8 && azules <= 5) return { type: 'stable', label: '‚ÜîÔ∏è ESTABLE', emoji: 'üü°', ok: true, wait: 6, conf: 65 };
            return { type: 'neutral', label: '‚ö™ NEUTRAL', emoji: '‚ö™', ok: true, wait: 8, conf: 55 };
        }

        function getRange() {
            const last20 = crashes.slice(-20);
            const avg = last20.reduce((a, c) => a + c, 0) / 20;
            const t = trend();

            let min, max;
            if (t.type === 'bull') { min = avg * 0.85; max = avg * 1.3; }
            else if (t.type === 'stable') { min = avg * 0.8; max = avg * 1.2; }
            else { min = Math.max(1.8, avg * 0.7); max = Math.max(2.8, avg * 1.1); }

            return { min: Math.max(1.5, min).toFixed(2), max: Math.max(2.5, max).toFixed(2) };
        }

        function update() {
            const t = trend();
            const sigBox = document.getElementById('signal');

            // Renders
            document.getElementById('crashGrid').innerHTML = crashes.slice(-60).reverse().map(c => 
                `<div class="crash ${cat(c)}">${c.toFixed(2)}</div>`).join('');

            document.getElementById('rounds').textContent = crashes.length;
            document.getElementById('signals').textContent = signals.length;
            const won = signals.filter(s => s.result === 'WIN').length;
            document.getElementById('won').textContent = won;
            document.getElementById('wr').textContent = signals.length > 0 ? Math.round((won / signals.length) * 100) + '%' : '--%';

            // Signal logic
            if (!t.ok) {
                sigBox.className = 'signal blocked';
                sigBox.innerHTML = `<div>üö´ ZONA PELIGROSA</div>`;
                wait = 0;
                return;
            }

            wait++;
            if (wait >= t.wait && signals.length >= 0 && (!signals[signals.length - 1] || signals[signals.length - 1].result)) {
                const range = getRange();
                signals.push({ min: range.min, max: range.max, result: null });
                wait = 0;
                sigBox.className = 'signal hot';
                sigBox.innerHTML = `
                    <div class="signal-text">${t.emoji} ‚úÖ SE√ëAL</div>
                    <div class="signal-value">${range.min}x - ${range.max}x</div>
                    <div class="signal-info">Confianza: ${t.conf}%</div>
                `;
            } else {
                sigBox.className = 'signal';
                sigBox.innerHTML = `
                    <div class="signal-text">${t.emoji} ESPERANDO</div>
                    <div class="signal-value" style="font-size:1.3em">${wait}/${t.wait}</div>
                    <div class="signal-info">${t.label}</div>
                `;
            }

            // Check signal
            if (signals.length > 0) {
                const lastSig = signals[signals.length - 1];
                if (!lastSig.result && crashes.length > 0) {
                    const last = crashes[crashes.length - 1];
                    if (last >= parseFloat(lastSig.min) && last <= parseFloat(lastSig.max)) {
                        lastSig.result = 'WIN';
                        lastSig.real = last.toFixed(2);
                    } else if (wait >= 2) {
                        lastSig.result = 'LOSE';
                        lastSig.real = last.toFixed(2);
                    }
                }
            }

            // History
            document.getElementById('history').innerHTML = signals.length === 0 ? '<p style="opacity:0.5;font-size:0.75em">Sin se√±ales</p>' : 
                signals.slice().reverse().map((s, i) => {
                    const res = s.result ? (s.result === 'WIN' ? 'win' : 'lose') : 'pending';
                    const txt = s.result ? (s.result === 'WIN' ? '‚úÖ GANADA' : '‚ùå PERDIDA') : '‚è≥ PENDIENTE';
                    return `<div class="sig-item ${res}">Se√±al ${signals.length - i}: ${s.min}x - ${s.max}x ${s.real ? `(Real: ${s.real}x)` : ''}<span class="badge ${res}">${txt}</span></div>`;
                }).join('');
        }

        // Load initial data
        db.ref('feeds/gocho/crashes').orderByKey().limitToLast(60).once('value', snap => {
            snap.forEach(child => {
                const v = child.val();
                if (v && v.v) crashes.push(v.v);
            });
            crashes.sort((a, b) => a - b);
            loaded = true;
            document.getElementById('status').textContent = '‚úÖ Conectado (60 rondas cargadas)';
            update();

            // Listen for new
            db.ref('feeds/gocho/crashes').on('child_added', s => {
                const v = s.val();
                if (v && v.v && crashes[crashes.length - 1] !== v.v) {
                    crashes.push(v.v);
                    if (crashes.length > 60) crashes.shift();
                    update();
                }
            });
        }).catch(err => {
            document.getElementById('status').textContent = '‚ùå Error de conexi√≥n';
            console.error(err);
        });
    </script>
</body>
</html>
