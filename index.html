<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sistema Aviator 1Win • Multi-Dispositivo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            font-size: clamp(1.5em, 5vw, 2.8em);
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sync-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 255, 136, 0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
            margin-left: 10px;
        }

        .sync-badge::before {
            content: '';
            width: 10px;
            height: 10px;
            background: #00ff88;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        .control-bar {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 12px;
            font-size: clamp(0.9em, 2vw, 1.1em);
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.stop {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .session-bar {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .session-title {
            font-size: clamp(1em, 3vw, 1.3em);
            font-weight: bold;
            margin-bottom: 15px;
            color: #667eea;
        }

        .device-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: clamp(0.8em, 2vw, 0.9em);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .session-progress {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .progress-bar {
            flex: 1;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.8em;
        }

        .session-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
        }

        .session-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .session-stat-label {
            font-size: clamp(0.7em, 2vw, 0.8em);
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .session-stat-value {
            font-size: clamp(1.2em, 3vw, 1.5em);
            font-weight: bold;
            color: #667eea;
        }

        .session-stat-value.success {
            color: #00ff88;
        }

        .session-stat-value.fail {
            color: #ff6b6b;
        }

        .status-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .status-item.active {
            border-color: #667eea;
            box-shadow: 0 0 25px rgba(102, 126, 234, 0.4);
            background: rgba(102, 126, 234, 0.15);
        }

        .status-label {
            font-size: clamp(0.7em, 2vw, 0.85em);
            opacity: 0.7;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .status-value {
            font-size: clamp(1.3em, 4vw, 2em);
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (min-width: 1024px) {
            .main-grid {
                grid-template-columns: 1.3fr 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-title {
            font-size: clamp(1.2em, 3vw, 1.6em);
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
            padding-bottom: 10px;
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        #trendChart {
            width: 100%;
            height: 100%;
        }

        .rounds-display {
            display: flex;
            gap: 5px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .round-item {
            min-width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-weight: bold;
            font-size: 0.85em;
            flex-shrink: 0;
        }

        .round-item.instaloss {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .round-item.low {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
        }

        .round-item.medium {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .round-item.high {
            background: linear-gradient(135deg, #b06ab3 0%, #4568dc 100%);
        }

        .signal-box {
            padding: 30px 20px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 15px 40px rgba(245, 87, 108, 0.4);
            position: relative;
            border: 3px solid transparent;
        }

        .signal-box.waiting {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .signal-box.green {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 15px 40px rgba(79, 172, 254, 0.4);
            animation: pulse-signal 2s infinite;
        }

        .signal-box.gold {
            background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            box-shadow: 0 15px 40px rgba(255, 210, 0, 0.6);
            border-color: #ffd700;
            animation: pulse-signal 2s infinite;
        }

        .signal-box.purple {
            background: linear-gradient(135deg, #b06ab3 0%, #4568dc 100%);
            box-shadow: 0 15px 40px rgba(176, 106, 179, 0.6);
            border-color: #b06ab3;
            animation: pulse-signal 2s infinite;
        }

        @keyframes pulse-signal {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .signal-title {
            font-size: clamp(0.8em, 2vw, 1em);
            margin-bottom: 15px;
            opacity: 0.95;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .signal-value {
            font-size: clamp(3em, 10vw, 4.5em);
            font-weight: 900;
            margin: 15px 0;
            text-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .signal-confidence {
            font-size: clamp(1em, 3vw, 1.3em);
            opacity: 0.95;
            font-weight: 600;
        }

        .signal-type {
            font-size: clamp(0.8em, 2vw, 0.9em);
            opacity: 0.85;
            margin-top: 10px;
            padding: 8px 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            display: inline-block;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: clamp(0.75em, 2vw, 0.9em);
        }

        .history-table th,
        .history-table td {
            padding: 10px 5px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .history-table th {
            background: rgba(102, 126, 234, 0.2);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .history-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .history-table tr.hit {
            background: rgba(0, 255, 136, 0.1);
        }

        .history-table tr.miss {
            background: rgba(255, 107, 107, 0.1);
        }

        .multiplier {
            padding: 5px 10px;
            border-radius: 8px;
            font-weight: 700;
            display: inline-block;
            font-size: 0.85em;
        }

        .multiplier.low {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .multiplier.medium {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
        }

        .multiplier.high {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .multiplier.ultra {
            background: linear-gradient(135deg, #b06ab3 0%, #4568dc 100%);
        }

        .result-badge {
            padding: 4px 8px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.8em;
        }

        .result-badge.hit {
            background: #00ff88;
            color: #000;
        }

        .result-badge.miss {
            background: #ff6b6b;
            color: #fff;
        }

        .result-badge.pending {
            background: #ffd93d;
            color: #000;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card-value {
            font-size: clamp(1.5em, 4vw, 2em);
            font-weight: 900;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card-label {
            font-size: clamp(0.7em, 2vw, 0.8em);
            opacity: 0.7;
            margin-top: 5px;
            text-transform: uppercase;
        }

        .alert {
            background: rgba(245, 87, 108, 0.2);
            border-left: 5px solid #f5576c;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-weight: 500;
            font-size: clamp(0.85em, 2vw, 1em);
        }

        .alert.warning {
            background: rgba(253, 203, 110, 0.2);
            border-left-color: #fdcb6e;
        }

        .alert.success {
            background: rgba(79, 172, 254, 0.2);
            border-left-color: #4facfe;
        }

        .alert.gold {
            background: rgba(255, 210, 0, 0.2);
            border-left-color: #ffd700;
        }

        .alert.purple {
            background: rgba(176, 106, 179, 0.2);
            border-left-color: #b06ab3;
        }

        .countdown {
            font-size: clamp(1.2em, 4vw, 1.5em);
            font-weight: 900;
            text-align: center;
            margin: 15px 0;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .live-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(245, 87, 108, 0.2);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: clamp(0.7em, 2vw, 0.85em);
            font-weight: 700;
            text-transform: uppercase;
        }

        .live-badge::before {
            content: '';
            width: 10px;
            height: 10px;
            background: #f5576c;
            border-radius: 50%;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .patterns-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }

        .pattern-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: clamp(0.8em, 2vw, 0.9em);
        }

        .pattern-item:last-child {
            border-bottom: none;
        }

        .pattern-badge {
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }

        .pattern-badge.high {
            background: #00ff88;
            color: #000;
        }

        .pattern-badge.medium {
            background: #ffd93d;
            color: #000;
        }

        .pattern-badge.low {
            background: #ff6b6b;
            color: #fff;
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
            }

            .panel {
                padding: 15px;
            }

            .history-table {
                font-size: 0.7em;
            }

            .history-table th,
            .history-table td {
                padding: 8px 3px;
            }

            .rounds-display {
                gap: 3px;
            }

            .round-item {
                min-width: 40px;
                height: 40px;
                font-size: 0.75em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎯 Sistema Aviator 1Win <span class="sync-badge">SYNC</span></h1>
            <p style="opacity: 0.85; font-size: clamp(0.9em, 2vw, 1.1em);">Aprendizaje de Patrones • Sincronización Multi-Dispositivo</p>
            <div style="margin-top: 10px;">
                <span class="live-badge">EN VIVO</span>
            </div>
        </div>

        <div class="control-bar">
            <button class="btn" id="btnStart" onclick="startSession()">🚀 INICIAR</button>
            <button class="btn stop" id="btnStop" onclick="stopSession()" disabled>⏹️ DETENER</button>
            <button class="btn" onclick="resetSession()">🔄 RESET</button>
        </div>

        <div class="session-bar">
            <div class="session-title">📊 SESIÓN SINCRONIZADA</div>
            
            <div class="device-info">
                <span>📱 <strong id="deviceName">--</strong></span>
                <span>🔗 Conectados: <strong id="devicesConnected">0</strong></span>
            </div>

            <div class="session-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="sessionProgress" style="width: 0%">0/60</div>
                </div>
            </div>

            <div class="session-stats">
                <div class="session-stat">
                    <div class="session-stat-label">Rondas</div>
                    <div class="session-stat-value" id="totalRoundsSession">0</div>
                </div>
                <div class="session-stat">
                    <div class="session-stat-label">1.70x+</div>
                    <div class="session-stat-value" id="signals170">0/4</div>
                </div>
                <div class="session-stat">
                    <div class="session-stat-label">3x+</div>
                    <div class="session-stat-value" id="signals3x">0/3</div>
                </div>
                <div class="session-stat">
                    <div class="session-stat-label">10x+</div>
                    <div class="session-stat-value" id="signals10x">0/2</div>
                </div>
                <div class="session-stat">
                    <div class="session-stat-label">Efectividad</div>
                    <div class="session-stat-value" id="sessionEffectiveness">0%</div>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item active">
                <div class="status-label">Estado</div>
                <div class="status-value" id="connectionStatus">⚪ OFF</div>
            </div>
            <div class="status-item">
                <div class="status-label">Señales</div>
                <div class="status-value" id="totalSignals">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Aciertos</div>
                <div class="status-value success" id="totalHits">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">Fallos</div>
                <div class="status-value fail" id="totalMisses">0</div>
            </div>
        </div>

        <div class="main-grid">
            <div class="panel">
                <h2 class="panel-title">📈 Gráfica de Tendencia</h2>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>

                <h3 style="font-size: clamp(1em, 3vw, 1.2em); margin-bottom: 10px;">Últimas 60 Rondas</h3>
                <div class="rounds-display" id="roundsDisplay">
                    <div style="opacity: 0.5; padding: 20px; text-align: center; width: 100%;">Sin datos</div>
                </div>

                <h3 style="font-size: clamp(1em, 3vw, 1.2em); margin: 20px 0 10px 0;">🎯 Señal Actual</h3>
                
                <div class="signal-box waiting" id="signalBox">
                    <div class="signal-title">ESPERANDO</div>
                    <div class="signal-value" id="signalMultiplier">--</div>
                    <div class="signal-confidence">Confianza: <span id="confidence">--</span></div>
                    <div class="signal-type" id="signalType">Inicia sesión</div>
                </div>

                <div class="countdown" id="countdown">Sistema detenido</div>

                <div class="alert success" id="alertBox">
                    <strong>⏸️ Sistema detenido:</strong> Haz clic en "INICIAR" para comenzar.
                </div>
            </div>

            <div class="panel">
                <h2 class="panel-title">🧠 Aprendizaje de Patrones</h2>
                
                <div class="patterns-box">
                    <h3 style="font-size: clamp(0.9em, 2vw, 1em); margin-bottom: 10px;">Patrones Detectados</h3>
                    <div class="pattern-item">
                        <span>Instaloss → Medio</span>
                        <span class="pattern-badge high" id="patternInstalossToMedium">0%</span>
                    </div>
                    <div class="pattern-item">
                        <span>Racha Baja → Alto</span>
                        <span class="pattern-badge medium" id="patternLowStreakToHigh">0%</span>
                    </div>
                    <div class="pattern-item">
                        <span>Alto → Instaloss</span>
                        <span class="pattern-badge low" id="patternHighToInstaloss">0%</span>
                    </div>
                    <div class="pattern-item">
                        <span>Medio → Medio</span>
                        <span class="pattern-badge medium" id="patternMediumToMedium">0%</span>
                    </div>
                </div>

                <h3 style="font-size: clamp(0.9em, 2vw, 1em); margin: 20px 0 10px 0;">📊 Análisis en Tiempo Real</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="avgLast10">--</div>
                        <div class="stat-card-label">Prom. 10</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="instalossCount">0</div>
                        <div class="stat-card-label">Instaloss</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="lowCount">0</div>
                        <div class="stat-card-label">Bajos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="highCount">0</div>
                        <div class="stat-card-label">Altos</div>
                    </div>
                </div>

                <h3 style="font-size: clamp(0.9em, 2vw, 1em); margin: 20px 0 10px 0;">Indicadores Clave</h3>
                <table class="history-table">
                    <tbody>
                        <tr>
                            <td style="text-align: left;">Tendencia</td>
                            <td id="trendIndicator">--</td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">Racha Baja</td>
                            <td id="lowStreak">0</td>
                        </tr>
                        <tr>
                            <td style="text-align: left;">Patrón Actual</td>
                            <td id="currentPattern">--</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="panel">
            <h2 class="panel-title">🎯 Historial de Señales</h2>
            <div style="overflow-x: auto;">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Hora</th>
                            <th>Target</th>
                            <th>Tipo</th>
                            <th>Conf.</th>
                            <th>Real</th>
                            <th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="signalsTableBody">
                        <tr>
                            <td colspan="7" style="opacity: 0.6; padding: 20px;">No hay señales</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue, get, set, update, remove, onDisconnect } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDuEnNg5XutDF3Ka90o6GFKTazBLR9NnSs",
            databaseURL: "https://aviator-analyzer-b29a7-default-rtdb.firebaseio.com",
            projectId: "aviator-analyzer-b29a7"
        };

        const CONFIG = {
            SESSION_SIZE: 60,
            MAX_SIGNALS_170: 4,
            MAX_SIGNALS_3X: 3,
            MAX_SIGNALS_10X: 2,
            MIN_CONFIDENCE: 82,
            SIGNAL_COOLDOWN: 40000,
            MIN_DATA_POINTS: 15
        };

        const DEVICE_ID = `device_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        const DEVICE_NAME = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent) ? '📱 Móvil' : '💻 PC';

        let gameHistory = [];
        let patternMemory = {
            instalossToMedium: { count: 0, success: 0 },
            lowStreakToHigh: { count: 0, success: 0 },
            highToInstaloss: { count: 0, success: 0 },
            mediumToMedium: { count: 0, success: 0 }
        };
        let isMaster = false;
        let lastProcessedTimestamp = 0;
        let chart = null;

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSignalSound(type) {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === '170') {
                oscillator.frequency.value = 523.25;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.4, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.0);
                oscillator.start(audioCtx.currentTime);
                oscillator.stop(audioCtx.currentTime + 1.0);
            } else if (type === '3x') {
                for (let i = 0; i < 2; i++) {
                    setTimeout(() => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain);
                        gain.connect(audioCtx.destination);
                        osc.frequency.value = 659.25 + (i * 100);
                        osc.type = 'square';
                        gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
                        osc.start(audioCtx.currentTime);
                        osc.stop(audioCtx.currentTime + 0.8);
                    }, i * 300);
                }
            } else if (type === '10x') {
                for (let i = 0; i < 4; i++) {
                    setTimeout(() => {
                        const osc = audioCtx.createOscillator();
                        const gain = audioCtx.createGain();
                        osc.connect(gain);
                        gain.connect(audioCtx.destination);
                        osc.frequency.value = 1046.50;
                        osc.type = 'sawtooth';
                        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
                        osc.start(audioCtx.currentTime);
                        osc.stop(audioCtx.currentTime + 0.4);
                    }, i * 200);
                }
            }
        }

        console.log('🔥 Inicializando...');
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        document.getElementById('deviceName').textContent = DEVICE_NAME;

        const possiblePaths = ['feeds/gocho/crashes', 'crashes', 'historial', 'last_final'];

        // ===== GRÁFICA =====
        function initChart() {
            const canvas = document.getElementById('trendChart');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;
            chart = { canvas, ctx };
        }

        function drawChart() {
            if (!chart || gameHistory.length < 2) return;

            const { ctx, canvas } = chart;
            const width = canvas.width;
            const height = canvas.height;

            ctx.clearRect(0, 0, width, height);

            const data = gameHistory.slice(0, 60).reverse();
            const maxVal = Math.max(...data.map(r => r.multiplier), 10);
            const stepX = width / (data.length - 1 || 1);

            // Línea de tendencia
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.beginPath();

            data.forEach((round, i) => {
                const x = i * stepX;
                const y = height - (round.multiplier / maxVal) * height;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });

            ctx.stroke();

            // Puntos
            data.forEach((round, i) => {
                const x = i * stepX;
                const y = height - (round.multiplier / maxVal) * height;
                
                let color = '#4facfe';
                if (round.type === 'INSTALOSS') color = '#f5576c';
                else if (round.type === 'ULTRA') color = '#b06ab3';
                else if (round.type === 'ALTO') color = '#00ff88';

                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // ===== SINCRONIZACIÓN =====
        const sessionRef = ref(db, 'shared_session');
        onValue(sessionRef, (snapshot) => {
            if (snapshot.exists()) {
                updateUIFromShared(snapshot.val());
            }
        });

        const signalsRef = ref(db, 'shared_signals');
        onValue(signalsRef, (snapshot) => {
            if (snapshot.exists()) {
                updateSignalsFromShared(snapshot.val());
            }
        });

        const currentSignalRef = ref(db, 'current_signal');
        onValue(currentSignalRef, (snapshot) => {
            if (snapshot.exists()) {
                displaySharedSignal(snapshot.val());
            } else {
                clearSignalDisplay();
            }
        });

        const devicesRef = ref(db, 'connected_devices');
        onValue(devicesRef, (snapshot) => {
            if (snapshot.exists()) {
                const count = Object.keys(snapshot.val()).length;
                document.getElementById('devicesConnected').textContent = count;
            }
        });

        const patternsRef = ref(db, 'pattern_memory');
        onValue(patternsRef, (snapshot) => {
            if (snapshot.exists()) {
                patternMemory = snapshot.val();
                updatePatternsDisplay();
            }
        });

        async function registerDevice() {
            const deviceRef = ref(db, `connected_devices/${DEVICE_ID}`);
            await set(deviceRef, {
                name: DEVICE_NAME,
                connectedAt: Date.now()
            });
            onDisconnect(deviceRef).remove();
        }

        async function checkIfMaster() {
            const sessionSnapshot = await get(ref(db, 'shared_session'));
            if (!sessionSnapshot.exists() || !sessionSnapshot.val().active) {
                isMaster = true;
                console.log('👑 MAESTRO');
            } else {
                isMaster = false;
                console.log('📱 ESCLAVO');
            }
        }

        window.startSession = async function() {
            await registerDevice();
            await checkIfMaster();
            
            if (isMaster) {
                await set(ref(db, 'shared_session'), {
                    active: true,
                    startTime: Date.now(),
                    totalRounds: 0,
                    sessionRounds: 0,
                    signals170: 0,
                    signals3x: 0,
                    signals10x: 0,
                    totalSignals: 0,
                    hits: 0,
                    misses: 0,
                    lastSignalTime: 0
                });

                await set(ref(db, 'shared_signals'), {});
                await remove(ref(db, 'current_signal'));
                await findAndConnect();
            }

            document.getElementById('btnStart').disabled = true;
            document.getElementById('btnStop').disabled = false;
            updateConnectionStatus('🟢 ON', true);
            showAlert(isMaster ? '👑 <strong>MAESTRO</strong> - Sesión iniciada' : '📱 <strong>ESCLAVO</strong> - Conectado a sesión', 'success');
        };

        window.stopSession = async function() {
            if (isMaster) {
                await update(ref(db, 'shared_session'), { active: false });
            }
            await remove(ref(db, `connected_devices/${DEVICE_ID}`));
            
            document.getElementById('btnStart').disabled = false;
            document.getElementById('btnStop').disabled = true;
            updateConnectionStatus('⚪ OFF', false);
            showAlert('⏹️ Detenido', 'warning');
        };

        window.resetSession = async function() {
            if (!confirm('¿Resetear sesión en todos los dispositivos?')) return;
            await stopSession();
            await set(ref(db, 'shared_session'), {});
            await set(ref(db, 'shared_signals'), {});
            await remove(ref(db, 'current_signal'));
            showAlert('🔄 Reseteado', 'success');
        };

        async function findAndConnect() {
            for (const path of possiblePaths) {
                try {
                    const testRef = ref(db, path);
                    const snapshot = await get(testRef);
                    if (snapshot.exists()) {
                        console.log(`✅ Datos en /${path}`);
                        listenToPath(path);
                        return;
                    }
                } catch (error) {
                    console.error(`❌ ${path}:`, error.message);
                }
            }
        }

        function listenToPath(path) {
            const dataRef = ref(db, path);
            onValue(dataRef, async (snapshot) => {
                if (!isMaster) return;
                try {
                    if (snapshot.exists()) {
                        const data = snapshot.val();
                        processData(data);
                        
                        if (gameHistory.length > 0) {
                            const latest = gameHistory[0];
                            if (latest.ts !== lastProcessedTimestamp) {
                                lastProcessedTimestamp = latest.ts;
                                
                                const sessionSnapshot = await get(ref(db, 'shared_session'));
                                if (sessionSnapshot.exists()) {
                                    const session = sessionSnapshot.val();
                                    await update(ref(db, 'shared_session'), {
                                        totalRounds: (session.totalRounds || 0) + 1,
                                        sessionRounds: (session.sessionRounds || 0) + 1
                                    });
                                }

                                console.log(`🆕 ${latest.multiplier}x`);
                                await checkPendingSignal(latest.multiplier);
                                await learnPattern(latest);
                                setTimeout(() => analyzeAndEmit(), 1000);
                            }
                        }
                    }
                } catch (error) {
                    console.error('❌', error);
                }
            });
        }

        function processData(data) {
            const crashesArray = [];
            for (const [key, value] of Object.entries(data)) {
                let crashValue, crashTime;
                if (typeof value === 'object') {
                    crashValue = value.v || value.value || value.multiplier || 0;
                    crashTime = value.ts || value.t || value.i || value.timestamp || parseInt(key) || Date.now();
                } else {
                    crashValue = parseFloat(value);
                    crashTime = parseInt(key) || Date.now();
                }
                if (crashValue > 0 && crashValue < 1000) {
                    crashesArray.push({ value: parseFloat(crashValue), timestamp: crashTime });
                }
            }
            crashesArray.sort((a, b) => b.timestamp - a.timestamp);
            gameHistory = crashesArray.slice(0, 60).map((crash, index) => ({
                id: index + 1,
                ts: crash.timestamp,
                timestamp: new Date(crash.timestamp),
                multiplier: crash.value,
                type: classifyMultiplier(crash.value)
            }));
            updateRoundsDisplay();
            drawChart();
        }

        function classifyMultiplier(mult) {
            mult = parseFloat(mult);
            if (mult >= 1.00 && mult <= 1.04) return 'INSTALOSS';
            else if (mult >= 10.00) return 'ULTRA';
            else if (mult >= 5.00) return 'ALTO';
            else if (mult >= 1.70) return 'MEDIO';
            else return 'BAJO';
        }

        function updateRoundsDisplay() {
            const container = document.getElementById('roundsDisplay');
            container.innerHTML = '';
            
            gameHistory.slice(0, 60).reverse().forEach(round => {
                const div = document.createElement('div');
                div.className = `round-item ${round.type.toLowerCase()}`;
                div.textContent = round.multiplier.toFixed(2) + 'x';
                div.title = new Date(round.ts).toLocaleTimeString();
                container.appendChild(div);
            });

            container.scrollLeft = container.scrollWidth;
        }

        // ===== APRENDIZAJE DE PATRONES =====
        async function learnPattern(newRound) {
            if (gameHistory.length < 2) return;

            const prevRound = gameHistory[1];
            
            // Patrón: Instaloss → Medio
            if (prevRound.type === 'INSTALOSS' && newRound.type === 'MEDIO') {
                patternMemory.instalossToMedium.count++;
                patternMemory.instalossToMedium.success++;
            } else if (prevRound.type === 'INSTALOSS' && newRound.type !== 'MEDIO') {
                patternMemory.instalossToMedium.count++;
            }

            // Patrón: Racha Baja → Alto
            let lowStreak = 0;
            for (const r of gameHistory.slice(1, 6)) {
                if (r.type === 'BAJO' || r.type === 'INSTALOSS') lowStreak++;
                else break;
            }
            if (lowStreak >= 3 && (newRound.type === 'ALTO' || newRound.type === 'ULTRA')) {
                patternMemory.lowStreakToHigh.count++;
                patternMemory.lowStreakToHigh.success++;
            } else if (lowStreak >= 3) {
                patternMemory.lowStreakToHigh.count++;
            }

            // Patrón: Alto → Instaloss
            if ((prevRound.type === 'ALTO' || prevRound.type === 'ULTRA') && newRound.type === 'INSTALOSS') {
                patternMemory.highToInstaloss.count++;
                patternMemory.highToInstaloss.success++;
            } else if (prevRound.type === 'ALTO' || prevRound.type === 'ULTRA') {
                patternMemory.highToInstaloss.count++;
            }

            // Patrón: Medio → Medio
            if (prevRound.type === 'MEDIO' && newRound.type === 'MEDIO') {
                patternMemory.mediumToMedium.count++;
                patternMemory.mediumToMedium.success++;
            } else if (prevRound.type === 'MEDIO') {
                patternMemory.mediumToMedium.count++;
            }

            await set(ref(db, 'pattern_memory'), patternMemory);
        }

        function updatePatternsDisplay() {
            const calc = (p) => p.count > 0 ? ((p.success / p.count) * 100).toFixed(0) : 0;
            document.getElementById('patternInstalossToMedium').textContent = calc(patternMemory.instalossToMedium) + '%';
            document.getElementById('patternLowStreakToHigh').textContent = calc(patternMemory.lowStreakToHigh) + '%';
            document.getElementById('patternHighToInstaloss').textContent = calc(patternMemory.highToInstaloss) + '%';
            document.getElementById('patternMediumToMedium').textContent = calc(patternMemory.mediumToMedium) + '%';
        }

        async function checkPendingSignal(actualCrash) {
            const currentSignalSnapshot = await get(ref(db, 'current_signal'));
            if (!currentSignalSnapshot.exists()) return;

            const pendingSignal = currentSignalSnapshot.val();
            if (pendingSignal.checked) return;

            const targetMin = pendingSignal.target * 0.92;
            const hit = actualCrash >= targetMin;

            const sessionSnapshot = await get(ref(db, 'shared_session'));
            const session = sessionSnapshot.val();

            await update(ref(db, 'shared_session'), {
                hits: (session.hits || 0) + (hit ? 1 : 0),
                misses: (session.misses || 0) + (hit ? 0 : 1)
            });

            await update(ref(db, `shared_signals/${pendingSignal.id}`), {
                actualCrash: actualCrash,
                hit: hit,
                checked: true
            });

            await remove(ref(db, 'current_signal'));

            showAlert(hit ? `✅ ACIERTO! ${pendingSignal.target.toFixed(2)}x → ${actualCrash.toFixed(2)}x` : `❌ Fallo ${pendingSignal.target.toFixed(2)}x → ${actualCrash.toFixed(2)}x`, hit ? 'success' : 'warning');
        }

        async function analyzeAndEmit() {
            if (!isMaster) return;
            if (gameHistory.length < CONFIG.MIN_DATA_POINTS) return;

            const sessionSnapshot = await get(ref(db, 'shared_session'));
            const session = sessionSnapshot.val();

            const now = Date.now();
            const timeSinceLastSignal = now - (session.lastSignalTime || 0);
            if (timeSinceLastSignal < CONFIG.SIGNAL_COOLDOWN) return;

            const currentSignalSnapshot = await get(ref(db, 'current_signal'));
            if (currentSignalSnapshot.exists()) return;

            const last10 = gameHistory.slice(0, 10);
            const last5 = gameHistory.slice(0, 5);
            const last3 = gameHistory.slice(0, 3);

            const instaloss10 = last10.filter(r => r.type === 'INSTALOSS').length;
            const instaloss5 = last5.filter(r => r.type === 'INSTALOSS').length;
            const instaloss3 = last3.filter(r => r.type === 'INSTALOSS').length;
            const low10 = last10.filter(r => r.type === 'BAJO').length;
            const low5 = last5.filter(r => r.type === 'BAJO').length;
            const high10 = last10.filter(r => r.type === 'ALTO' || r.type === 'ULTRA').length;

            const avg10 = last10.reduce((sum, r) => sum + r.multiplier, 0) / 10;
            const avg5 = last5.reduce((sum, r) => sum + r.multiplier, 0) / 5;

            let lowStreak = 0;
            for (const r of gameHistory) {
                if (r.type === 'BAJO' || r.type === 'INSTALOSS') lowStreak++;
                else break;
            }

            // Patrón actual detectado
            const prevType = gameHistory[1]?.type || '';
            document.getElementById('currentPattern').textContent = prevType ? `${prevType} detectado` : '--';

            // Usar patrones aprendidos
            const instalossToMediumProb = patternMemory.instalossToMedium.count > 5 
                ? (patternMemory.instalossToMedium.success / patternMemory.instalossToMedium.count) 
                : 0.7;

            const lowStreakToHighProb = patternMemory.lowStreakToHigh.count > 5
                ? (patternMemory.lowStreakToHigh.success / patternMemory.lowStreakToHigh.count)
                : 0.65;

            let signal = null;

            // SEÑALES MEJORADAS CON APRENDIZAJE
            if (session.signals170 < CONFIG.MAX_SIGNALS_170) {
                // Opción 1: Instaloss reciente + patrón aprendido alto
                if (instaloss3 >= 1 && low5 >= 3 && instalossToMediumProb > 0.65) {
                    signal = {
                        id: `signal_${Date.now()}`,
                        timestamp: Date.now(),
                        target: 1.75,
                        confidence: Math.round(instalossToMediumProb * 100),
                        type: '🎯 SEÑAL 1.70x+',
                        color: 'green',
                        soundType: '170',
                        category: '170',
                        reason: `Instaloss + Patrón ${Math.round(instalossToMediumProb * 100)}%`,
                        checked: false
                    };
                    await update(ref(db, 'shared_session'), { signals170: session.signals170 + 1 });
                }
                // Opción 2: Racha baja fuerte
                else if (lowStreak >= 4 && avg5 < 1.9) {
                    signal = {
                        id: `signal_${Date.now()}`,
                        timestamp: Date.now(),
                        target: 1.80,
                        confidence: 86,
                        type: '🎯 SEÑAL 1.70x+',
                        color: 'green',
                        soundType: '170',
                        category: '170',
                        reason: `Racha baja ${lowStreak}`,
                        checked: false
                    };
                    await update(ref(db, 'shared_session'), { signals170: session.signals170 + 1 });
                }
                // Opción 3: Promedio muy bajo + sin altos
                else if (avg10 < 2.1 && high10 === 0 && low10 >= 6) {
                    signal = {
                        id: `signal_${Date.now()}`,
                        timestamp: Date.now(),
                        target: 1.85,
                        confidence: 84,
                        type: '🎯 SEÑAL 1.70x+',
                        color: 'green',
                        soundType: '170',
                        category: '170',
                        reason: `Prom ${avg10.toFixed(2)}x sin altos`,
                        checked: false
                    };
                    await update(ref(db, 'shared_session'), { signals170: session.signals170 + 1 });
                }
            }

            if (!signal && session.signals3x < CONFIG.MAX_SIGNALS_3X) {
                if (instaloss10 >= 2 && high10 === 0 && avg10 < 2.4 && lowStreakToHighProb > 0.6) {
                    signal = {
                        id: `signal_${Date.now()}`,
                        timestamp: Date.now(),
                        target: 3.20,
                        confidence: Math.round(lowStreakToHighProb * 100),
                        type: '🌟 SEÑAL 3x+',
                        color: 'gold',
                        soundType: '3x',
                        category: '3x',
                        reason: `${instaloss10} instalosses + Patrón`,
                        checked: false
                    };
                    await update(ref(db, 'shared_session'), { signals3x: session.signals3x + 1 });
                }
            }

            if (!signal && session.signals10x < CONFIG.MAX_SIGNALS_10X) {
                if (instaloss10 >= 3 && high10 === 0 && avg10 < 1.95 && lowStreak >= 5) {
                    signal = {
                        id: `signal_${Date.now()}`,
                        timestamp: Date.now(),
                        target: 11.00,
                        confidence: 87,
                        type: '💎 SEÑAL 10x+',
                        color: 'purple',
                        soundType: '10x',
                        category: '10x',
                        reason: 'Patrón extremo',
                        checked: false
                    };
                    await update(ref(db, 'shared_session'), { signals10x: session.signals10x + 1 });
                }
            }

            if (signal) {
                console.log(`🎯 ${signal.target.toFixed(2)}x [${signal.confidence}%]`);
                
                await update(ref(db, 'shared_session'), {
                    totalSignals: (session.totalSignals || 0) + 1,
                    lastSignalTime: now
                });

                await set(ref(db, 'current_signal'), signal);
                await set(ref(db, `shared_signals/${signal.id}`), signal);
                playSignalSound(signal.soundType);
            }
        }

        function updateUIFromShared(sessionData) {
            const sessionProgress = Math.min((sessionData.sessionRounds / CONFIG.SESSION_SIZE) * 100, 100);
            document.getElementById('sessionProgress').style.width = sessionProgress + '%';
            document.getElementById('sessionProgress').textContent = `${sessionData.sessionRounds}/${CONFIG.SESSION_SIZE}`;

            document.getElementById('totalRoundsSession').textContent = sessionData.totalRounds || 0;
            document.getElementById('signals170').textContent = `${sessionData.signals170 || 0}/${CONFIG.MAX_SIGNALS_170}`;
            document.getElementById('signals3x').textContent = `${sessionData.signals3x || 0}/${CONFIG.MAX_SIGNALS_3X}`;
            document.getElementById('signals10x').textContent = `${sessionData.signals10x || 0}/${CONFIG.MAX_SIGNALS_10X}`;

            const effectiveness = sessionData.totalSignals > 0 
                ? ((sessionData.hits / sessionData.totalSignals) * 100).toFixed(0)
                : 0;
            document.getElementById('sessionEffectiveness').textContent = effectiveness + '%';

            document.getElementById('totalSignals').textContent = sessionData.totalSignals || 0;
            document.getElementById('totalHits').textContent = sessionData.hits || 0;
            document.getElementById('totalMisses').textContent = sessionData.misses || 0;
        }

        function updateSignalsFromShared(signalsData) {
            const tbody = document.getElementById('signalsTableBody');
            tbody.innerHTML = '';

            const signalsArray = Object.values(signalsData).sort((a, b) => b.timestamp - a.timestamp);

            if (signalsArray.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="opacity: 0.6; padding: 20px;">No hay señales</td></tr>';
                return;
            }

            signalsArray.forEach((sig, index) => {
                const row = tbody.insertRow();
                row.className = sig.checked ? (sig.hit ? 'hit' : 'miss') : 'pending';
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${new Date(sig.timestamp).toLocaleTimeString('es-VE')}</td>
                    <td><strong>${sig.target.toFixed(2)}x</strong></td>
                    <td>${sig.type}</td>
                    <td>${sig.confidence}%</td>
                    <td>${sig.actualCrash ? sig.actualCrash.toFixed(2) + 'x' : '--'}</td>
                    <td><span class="result-badge ${sig.checked ? (sig.hit ? 'hit' : 'miss') : 'pending'}">${sig.checked ? (sig.hit ? '✅' : '❌') : '⏳'}</span></td>
                `;
            });
        }

        function displaySharedSignal(signalData) {
            const signalBox = document.getElementById('signalBox');
            const signalMultiplier = document.getElementById('signalMultiplier');
            const confidence = document.getElementById('confidence');
            const signalType = document.getElementById('signalType');
            const alertBox = document.getElementById('alertBox');

            signalBox.className = `signal-box ${signalData.color}`;
            signalMultiplier.textContent = signalData.target.toFixed(2) + 'x';
            confidence.textContent = signalData.confidence + '%';
            signalType.textContent = signalData.type;

            alertBox.className = `alert ${signalData.color === 'green' ? 'success' : signalData.color === 'gold' ? 'gold' : 'purple'}`;
            alertBox.innerHTML = `<strong>🎯 SEÑAL:</strong> ${signalData.type} | ${signalData.reason}`;

            playSignalSound(signalData.soundType);
        }

        function clearSignalDisplay() {
            const signalBox = document.getElementById('signalBox');
            const signalMultiplier = document.getElementById('signalMultiplier');
            const confidence = document.getElementById('confidence');
            const signalType = document.getElementById('signalType');

            signalBox.className = 'signal-box waiting';
            signalMultiplier.textContent = '--';
            confidence.textContent = '--';
            signalType.textContent = 'Esperando...';
        }

        function updateConnectionStatus(text) {
            document.getElementById('connectionStatus').textContent = text;
        }

        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = 'alert ' + type;
            alertBox.innerHTML = message;
        }

        setInterval(async () => {
            const sessionSnapshot = await get(ref(db, 'shared_session'));
            if (sessionSnapshot.exists()) {
                const session = sessionSnapshot.val();
                if (session.active && gameHistory.length > 0) {
                    const last10 = gameHistory.slice(0, Math.min(10, gameHistory.length));
                    const avg10 = last10.reduce((sum, r) => sum + r.multiplier, 0) / last10.length;
                    
                    document.getElementById('avgLast10').textContent = avg10.toFixed(2) + 'x';
                    document.getElementById('instalossCount').textContent = last10.filter(r => r.type === 'INSTALOSS').length;
                    document.getElementById('lowCount').textContent = last10.filter(r => r.type === 'BAJO').length;
                    document.getElementById('highCount').textContent = last10.filter(r => r.type === 'ALTO' || r.type === 'ULTRA').length;

                    let lowStreak = 0;
                    for (const r of gameHistory) {
                        if (r.type === 'BAJO' || r.type === 'INSTALOSS') lowStreak++;
                        else break;
                    }
                    document.getElementById('lowStreak').textContent = lowStreak;

                    const avg5 = gameHistory.slice(0, 5).reduce((sum, r) => sum + r.multiplier, 0) / 5;
                    document.getElementById('trendIndicator').textContent = avg5 < avg10 ? '⬇️ BAJISTA' : '⬆️ ALCISTA';

                    const timeSince = Date.now() - (session.lastSignalTime || 0);
                    if (timeSince < CONFIG.SIGNAL_COOLDOWN) {
                        const remaining = Math.ceil((CONFIG.SIGNAL_COOLDOWN - timeSince) / 1000);
                        document.getElementById('countdown').textContent = `Próximo análisis: ${remaining}s`;
                    } else {
                        document.getElementById('countdown').textContent = 'Analizando...';
                    }
                }
            }
        }, 1000);

        initChart();
        console.log('✅ Listo');
    </script>
</body>
</html>
