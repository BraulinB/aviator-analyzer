<!doctype html>
<meta charset="utf-8">
<title>Diagn√≥stico getDisplayMedia</title>
<button id="start">Compartir pantalla</button>
<button id="stop">Detener</button>
<div id="log" style="font:14px system-ui; margin:10px 0;"></div>
<video id="v" autoplay muted playsinline style="width:640px;max-width:100%;border:1px solid #999;border-radius:8px;background:#111"></video>
<script>
const log = m => (document.getElementById('log').innerHTML = `[${new Date().toLocaleTimeString()}] ${m}`);
let stream=null;
document.getElementById('start').onclick = async () => {
  try{
    if(!navigator.mediaDevices?.getDisplayMedia) { alert('Sin getDisplayMedia'); return; }
    stream = await navigator.mediaDevices.getDisplayMedia({video:true, audio:false});
    document.getElementById('v').srcObject = stream;
    log('Stream OK: '+(stream.getVideoTracks()[0]?.label||'(sin etiqueta)'));
  }catch(e){ log(`Error: ${e.name} - ${e.message}`); }
};
document.getElementById('stop').onclick = () => {
  try{ stream?.getTracks().forEach(t=>t.stop()); }catch(_){}
  document.getElementById('v').srcObject = null;
  log('Detenido');
};
</script>
